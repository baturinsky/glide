!function(){"use strict";function e(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function u(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}l((n=n.apply(e,t||[])).next())})}let t=Float32Array;function r(e,r,n){const o=new t(3);return e&&(o[0]=e),r&&(o[1]=r),n&&(o[2]=n),o}function n(e,r,n){return(n=n||new t(3))[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function o(e,r,n){n=n||new t(3);const o=e[2]*r[0]-e[0]*r[2],i=e[0]*r[1]-e[1]*r[0];return n[0]=e[1]*r[2]-e[2]*r[1],n[1]=o,n[2]=i,n}function i(e,r){r=r||new t(3);const n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],o=Math.sqrt(n);return o>1e-5?(r[0]=e[0]/o,r[1]=e[1]/o,r[2]=e[2]/o):(r[0]=0,r[1]=0,r[2]=0),r}let a=Float32Array;const u=r(),l=r(),s=r();function c(e,t){if((t=t||new a(16))===e){let r;return r=e[1],e[1]=e[4],e[4]=r,r=e[2],e[2]=e[8],e[8]=r,r=e[3],e[3]=e[12],e[12]=r,r=e[6],e[6]=e[9],e[9]=r,r=e[7],e[7]=e[13],e[13]=r,r=e[11],e[11]=e[14],e[14]=r,t}const r=e[0],n=e[1],o=e[2],i=e[3],u=e[4],l=e[5],s=e[6],c=e[7],f=e[8],m=e[9],d=e[10],E=e[11],b=e[12],y=e[13],p=e[14],_=e[15];return t[0]=r,t[1]=u,t[2]=f,t[3]=b,t[4]=n,t[5]=l,t[6]=m,t[7]=y,t[8]=o,t[9]=s,t[10]=d,t[11]=p,t[12]=i,t[13]=c,t[14]=E,t[15]=_,t}function f(e,t){t=t||new a(16);const r=e[0],n=e[1],o=e[2],i=e[3],u=e[4],l=e[5],s=e[6],c=e[7],f=e[8],m=e[9],d=e[10],E=e[11],b=e[12],y=e[13],p=e[14],_=e[15],h=d*_,T=p*E,A=s*_,R=p*c,x=s*E,g=d*c,F=o*_,P=p*i,v=o*E,U=d*i,w=o*c,I=s*i,S=f*y,B=b*m,L=u*y,M=b*l,C=u*m,N=f*l,O=r*y,D=b*n,G=r*m,z=f*n,X=r*l,k=u*n,W=h*l+R*m+x*y-(T*l+A*m+g*y),K=T*n+F*m+U*y-(h*n+P*m+v*y),Y=A*n+P*l+w*y-(R*n+F*l+I*y),H=g*n+v*l+I*m-(x*n+U*l+w*m),V=1/(r*W+u*K+f*Y+b*H);return t[0]=V*W,t[1]=V*K,t[2]=V*Y,t[3]=V*H,t[4]=V*(T*u+A*f+g*b-(h*u+R*f+x*b)),t[5]=V*(h*r+P*f+v*b-(T*r+F*f+U*b)),t[6]=V*(R*r+F*u+I*b-(A*r+P*u+w*b)),t[7]=V*(x*r+U*u+w*f-(g*r+v*u+I*f)),t[8]=V*(S*c+M*E+C*_-(B*c+L*E+N*_)),t[9]=V*(B*i+O*E+z*_-(S*i+D*E+G*_)),t[10]=V*(L*i+D*c+X*_-(M*i+O*c+k*_)),t[11]=V*(N*i+G*c+k*E-(C*i+z*c+X*E)),t[12]=V*(L*d+N*p+B*s-(C*p+S*s+M*d)),t[13]=V*(G*p+S*o+D*d-(O*d+z*p+B*o)),t[14]=V*(O*s+k*p+M*o-(X*p+L*o+D*s)),t[15]=V*(X*d+C*o+z*s-(G*s+k*d+N*o)),t}function m(e,t,r){r=r||new a(16);const n=e[0],o=e[1],i=e[2],u=e[3],l=e[4],s=e[5],c=e[6],f=e[7],m=e[8],d=e[9],E=e[10],b=e[11],y=e[12],p=e[13],_=e[14],h=e[15],T=t[0],A=t[1],R=t[2],x=t[3],g=t[4],F=t[5],P=t[6],v=t[7],U=t[8],w=t[9],I=t[10],S=t[11],B=t[12],L=t[13],M=t[14],C=t[15];return r[0]=n*T+l*A+m*R+y*x,r[1]=o*T+s*A+d*R+p*x,r[2]=i*T+c*A+E*R+_*x,r[3]=u*T+f*A+b*R+h*x,r[4]=n*g+l*F+m*P+y*v,r[5]=o*g+s*F+d*P+p*v,r[6]=i*g+c*F+E*P+_*v,r[7]=u*g+f*F+b*P+h*v,r[8]=n*U+l*w+m*I+y*S,r[9]=o*U+s*w+d*I+p*S,r[10]=i*U+c*w+E*I+_*S,r[11]=u*U+f*w+b*I+h*S,r[12]=n*B+l*L+m*M+y*C,r[13]=o*B+s*L+d*M+p*C,r[14]=i*B+c*L+E*M+_*C,r[15]=u*B+f*L+b*M+h*C,r}function d(e,r,n,c){c=c||new a(16);const f=u,m=l,d=s;return i(function(e,r,n){return(n=n||new t(3))[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}(e,r,d),d),i(o(n,d,f),f),i(o(d,f,m),m),c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=0,c[4]=m[0],c[5]=m[1],c[6]=m[2],c[7]=0,c[8]=d[0],c[9]=d[1],c[10]=d[2],c[11]=0,c[12]=e[0],c[13]=e[1],c[14]=e[2],c[15]=1,c}const E=5120,b=5121,y=5122,p=5123,_=5124,h=5125,T=5126,A={};{const e=A;e[E]=Int8Array,e[b]=Uint8Array,e[y]=Int16Array,e[p]=Uint16Array,e[_]=Int32Array,e[h]=Uint32Array,e[T]=Float32Array,e[32819]=Uint16Array,e[32820]=Uint16Array,e[33635]=Uint16Array,e[5131]=Uint16Array,e[33640]=Uint32Array,e[35899]=Uint32Array,e[35902]=Uint32Array,e[36269]=Uint32Array,e[34042]=Uint32Array}function R(e){if(e instanceof Int8Array)return E;if(e instanceof Uint8Array)return b;if(e instanceof Uint8ClampedArray)return b;if(e instanceof Int16Array)return y;if(e instanceof Uint16Array)return p;if(e instanceof Int32Array)return _;if(e instanceof Uint32Array)return h;if(e instanceof Float32Array)return T;throw new Error("unsupported typed array type")}const x="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer},g="undefined"!=typeof console&&console.error&&"function"==typeof console.error?console.error.bind(console):function(){},F="undefined"!=typeof console&&console.warn&&"function"==typeof console.warn?console.warn.bind(console):function(){};function P(e,t){return"undefined"!=typeof WebGLTexture&&t instanceof WebGLTexture}const v={attribPrefix:""};function U(e,t,r,n){if(o=t,"undefined"!=typeof WebGLBuffer&&o instanceof WebGLBuffer)return t;var o;r=r||e.ARRAY_BUFFER;const i=e.createBuffer();return function(e,t,r,n,o){e.bindBuffer(t,r),e.bufferData(t,n,o||e.STATIC_DRAW)}(e,r,i,t,n),i}function w(e){return"indices"===e}const I=/coord|texture/i,S=/color|colour/i;function B(e,t){let r;if(t%(r=I.test(e)?2:S.test(e)?4:3)>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${r} but ${t} values is not evenly divisible by ${r}. You should specify it.`);return r}function L(e,t){if(x(e))return e;if(x(e.data))return e.data;Array.isArray(e)&&(e={data:e});let r=e.type;return r||(r=w(t)?Uint16Array:Float32Array),new r(e.data)}function M(e,t){const r={};return Object.keys(t).forEach(function(n){if(!w(n)){const i=t[n],a=i.attrib||i.name||i.attribName||v.attribPrefix+n;if(i.value){if(!Array.isArray(i.value)&&!x(i.value))throw new Error("array.value is not array or typedarray");r[a]={value:i.value}}else{let t,u,l,s;if(i.buffer&&i.buffer instanceof WebGLBuffer)t=i.buffer,s=i.numComponents||i.size,u=i.type,l=i.normalize;else if("number"==typeof i||"number"==typeof i.data){const r=i.data||i,a=i.type||Float32Array,c=r*a.BYTES_PER_ELEMENT;u=function(e){if(e===Int8Array)return E;if(e===Uint8Array)return b;if(e===Uint8ClampedArray)return b;if(e===Int16Array)return y;if(e===Uint16Array)return p;if(e===Int32Array)return _;if(e===Uint32Array)return h;if(e===Float32Array)return T;throw new Error("unsupported typed array type")}(a),l=void 0!==i.normalize?i.normalize:(o=a)===Int8Array||o===Uint8Array,s=i.numComponents||i.size||B(n,r),t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,c,i.drawType||e.STATIC_DRAW)}else{const r=L(i,n);t=U(e,r,void 0,i.drawType),u=R(r),l=void 0!==i.normalize?i.normalize:function(e){return e instanceof Int8Array||e instanceof Uint8Array}(r),s=function(e,t){return e.numComponents||e.size||B(t,function(e){return e.length?e:e.data}(e).length)}(i,n)}r[a]={buffer:t,numComponents:s,type:u,normalize:l,stride:i.stride||0,offset:i.offset||0,divisor:void 0===i.divisor?void 0:i.divisor,drawType:i.drawType}}}var o}),e.bindBuffer(e.ARRAY_BUFFER,null),r}const C=["position","positions","a_position"];function N(e,t,r){const n=M(e,t),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},n);const i=t.indices;if(i){const t=L(i,"indices");o.indices=U(e,t,e.ELEMENT_ARRAY_BUFFER),o.numElements=t.length,o.elementType=R(t)}else o.numElements||(o.numElements=function(e,t){let r,n;for(n=0;n<C.length&&!((r=C[n])in t)&&!((r=v.attribPrefix+r)in t);++n);n===C.length&&(r=Object.keys(t)[0]);const o=t[r];e.bindBuffer(e.ARRAY_BUFFER,o.buffer);const i=e.getBufferParameter(e.ARRAY_BUFFER,e.BUFFER_SIZE);e.bindBuffer(e.ARRAY_BUFFER,null);const a=i/function(e,t){return t===e.BYTE?1:t===e.UNSIGNED_BYTE?1:t===e.SHORT?2:t===e.UNSIGNED_SHORT?2:t===e.INT?4:t===e.UNSIGNED_INT?4:t===e.FLOAT?4:0}(e,o.type),u=o.numComponents||o.size,l=a/u;if(l%1!=0)throw new Error(`numComponents ${u} not correct for length ${length}`);return l}(e,o.attribs));return o}function O(e){return!!e.texStorage2D}const D=function(){const e={},t={};return function(r,n){return function(r){const n=r.constructor.name;if(!e[n]){for(const e in r)if("number"==typeof r[e]){const n=t[r[e]];t[r[e]]=n?`${n} | ${e}`:e}e[n]=!0}}(r),t[n]||"0x"+n.toString(16)}}(),G={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},z=x,X="undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null,k=6407,W=33319,K={};{const e=K;e[6406]={textureFormat:6406,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},e[6409]={textureFormat:6409,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},e[6410]={textureFormat:6410,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[5121,5131,36193,5126]},e[k]={textureFormat:k,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[5121,5131,36193,5126,33635]},e[6408]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[5121,5131,36193,5126,32819,32820]},e[33321]={textureFormat:6403,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[5121]},e[36756]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[5120]},e[33325]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[5126,5131]},e[33326]={textureFormat:6403,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[5126]},e[33330]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5121]},e[33329]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5120]},e[33332]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5123]},e[33331]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5122]},e[33334]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},e[33333]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5124]},e[33323]={textureFormat:W,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[5121]},e[36757]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[5120]},e[33327]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[5126,5131]},e[33328]={textureFormat:W,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[5126]},e[33336]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5121]},e[33335]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5120]},e[33338]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5123]},e[33337]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5122]},e[33340]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5125]},e[33339]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5124]},e[32849]={textureFormat:k,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[5121]},e[35905]={textureFormat:k,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5121]},e[36194]={textureFormat:k,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[5121,33635]},e[36758]={textureFormat:k,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5120]},e[35898]={textureFormat:k,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35899]},e[35901]={textureFormat:k,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35902]},e[34843]={textureFormat:k,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[5126,5131]},e[34837]={textureFormat:k,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5126]},e[36221]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5121]},e[36239]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5120]},e[36215]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5123]},e[36233]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5122]},e[36209]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5125]},e[36227]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5124]},e[32856]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},e[35907]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},e[36759]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[5120]},e[32855]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[5121,32820,33640]},e[32854]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[5121,32819]},e[32857]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[33640]},e[34842]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[5126,5131]},e[34836]={textureFormat:6408,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[5126]},e[36220]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5121]},e[36238]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5120]},e[36975]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[33640]},e[36214]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5123]},e[36232]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5122]},e[36226]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5124]},e[36208]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5125]},e[33189]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[5123,5125]},e[33190]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},e[36012]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5126]},e[35056]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[34042]},e[36013]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[36269]},Object.keys(e).forEach(function(t){const r=e[t];r.bytesPerElementMap={},r.bytesPerElement.forEach(function(e,t){const n=r.type[t];r.bytesPerElementMap[n]=e})})}function Y(e){const t=K[e];if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function H(e){return 0==(e&e-1)}function V(e,t,r,n,o){if(o%1!=0)throw"can't guess dimensions";if(r||n){if(n){if(!r&&(r=o/n)%1)throw"can't guess dimensions"}else if((n=o/r)%1)throw"can't guess dimensions"}else{const i=Math.sqrt(o/(t===e.TEXTURE_CUBE_MAP?6:1));i%1==0?(r=i,n=i):(r=o,n=1)}return{width:r,height:n}}const j={};function $(e,t){void 0!==t.colorspaceConversion&&(j.colorspaceConversion=e.getParameter(e.UNPACK_COLORSPACE_CONVERSION_WEBGL),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.colorspaceConversion)),void 0!==t.premultiplyAlpha&&(j.premultiplyAlpha=e.getParameter(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha)),void 0!==t.flipY&&(j.flipY=e.getParameter(e.UNPACK_FLIP_Y_WEBGL),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY))}function q(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,j.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,j.flipY)}function Z(e){j.unpackAlignment=e.getParameter(e.UNPACK_ALIGNMENT),O(e)&&(j.unpackRowLength=e.getParameter(e.UNPACK_ROW_LENGTH),j.unpackImageHeight=e.getParameter(e.UNPACK_IMAGE_HEIGHT),j.unpackSkipPixels=e.getParameter(e.UNPACK_SKIP_PIXELS),j.unpackSkipRows=e.getParameter(e.UNPACK_SKIP_ROWS),j.unpackSkipImages=e.getParameter(e.UNPACK_SKIP_IMAGES))}function J(e){e.pixelStorei(e.UNPACK_ALIGNMENT,j.unpackAlignment),O(e)&&(e.pixelStorei(e.UNPACK_ROW_LENGTH,j.unpackRowLength),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,j.unpackImageHeight),e.pixelStorei(e.UNPACK_SKIP_PIXELS,j.unpackSkipPixels),e.pixelStorei(e.UNPACK_SKIP_ROWS,j.unpackSkipRows),e.pixelStorei(e.UNPACK_SKIP_IMAGES,j.unpackSkipImages))}function Q(e,t,r,n){var o;n.minMag&&(r.call(e,t,e.TEXTURE_MIN_FILTER,n.minMag),r.call(e,t,e.TEXTURE_MAG_FILTER,n.minMag)),n.min&&r.call(e,t,e.TEXTURE_MIN_FILTER,n.min),n.mag&&r.call(e,t,e.TEXTURE_MAG_FILTER,n.mag),n.wrap&&(r.call(e,t,e.TEXTURE_WRAP_S,n.wrap),r.call(e,t,e.TEXTURE_WRAP_T,n.wrap),(t===e.TEXTURE_3D||(o=t,"undefined"!=typeof WebGLSampler&&o instanceof WebGLSampler))&&r.call(e,t,e.TEXTURE_WRAP_R,n.wrap)),n.wrapR&&r.call(e,t,e.TEXTURE_WRAP_R,n.wrapR),n.wrapS&&r.call(e,t,e.TEXTURE_WRAP_S,n.wrapS),n.wrapT&&r.call(e,t,e.TEXTURE_WRAP_T,n.wrapT),n.minLod&&r.call(e,t,e.TEXTURE_MIN_LOD,n.minLod),n.maxLod&&r.call(e,t,e.TEXTURE_MAX_LOD,n.maxLod),n.baseLevel&&r.call(e,t,e.TEXTURE_BASE_LEVEL,n.baseLevel),n.maxLevel&&r.call(e,t,e.TEXTURE_MAX_LEVEL,n.maxLevel)}function ee(e,t,r){const n=r.target||e.TEXTURE_2D;e.bindTexture(n,t),Q(e,n,e.texParameteri,r)}function te(e,t,r,n,o,i,a){r=r||G.textureOptions,i=i||e.RGBA,a=a||e.UNSIGNED_BYTE;const u=r.target||e.TEXTURE_2D;if(n=n||r.width,o=o||r.height,e.bindTexture(u,t),function(e,t,r,n){if(!O(e))return H(t)&&H(r);const o=K[n];if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}(e,n,o,i))e.generateMipmap(u);else{const t=function(e){const t=K[e];if(!t)throw"unknown internal format";return t.textureFilterable}(i)?e.LINEAR:e.NEAREST;e.texParameteri(u,e.TEXTURE_MIN_FILTER,t),e.texParameteri(u,e.TEXTURE_MAG_FILTER,t),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}}function re(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function ne(e,t){return(t=t||{}).cubeFaceOrder||[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z]}function oe(e,t){const r=ne(e,t).map(function(e,t){return{face:e,ndx:t}});return r.sort(function(e,t){return e.face-t.face}),r}function ie(e,t,r,n){const o=(n=n||G.textureOptions).target||e.TEXTURE_2D,i=n.level||0;let a=r.width,u=r.height;const l=n.internalFormat||n.format||e.RGBA,s=Y(l),c=n.format||s.format,f=n.type||s.type;if($(e,n),e.bindTexture(o,t),o===e.TEXTURE_CUBE_MAP){const s=r.width,m=r.height;let d,E;if(s/6===m)d=m,E=[0,0,1,0,2,0,3,0,4,0,5,0];else if(m/6===s)d=s,E=[0,0,0,1,0,2,0,3,0,4,0,5];else if(s/3==m/2)d=s/3,E=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(s/2!=m/3)throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);d=s/2,E=[0,0,1,0,0,1,1,1,0,2,1,2]}X?(X.canvas.width=d,X.canvas.height=d,a=d,u=d,oe(e,n).forEach(function(t){const n=E[2*t.ndx+0]*d,o=E[2*t.ndx+1]*d;X.drawImage(r,n,o,d,d,0,0,d,d),e.texImage2D(t.face,i,l,c,f,X.canvas)}),X.canvas.width=1,X.canvas.height=1):"undefined"!=typeof createImageBitmap&&(a=d,u=d,oe(e,n).forEach(function(s){const m=E[2*s.ndx+0]*d,b=E[2*s.ndx+1]*d;e.texImage2D(s.face,i,l,d,d,0,c,f,null),createImageBitmap(r,m,b,d,d,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(r){$(e,n),e.bindTexture(o,t),e.texImage2D(s.face,i,l,c,f,r),q(e,n),re(n)&&te(e,t,n,a,u,l,f)})}))}else if(o===e.TEXTURE_3D||o===e.TEXTURE_2D_ARRAY){const t=Math.min(r.width,r.height),n=Math.max(r.width,r.height),a=n/t;if(a%1!=0)throw"can not compute 3D dimensions of element";const u=r.width===n?1:0,s=r.height===n?1:0;Z(e),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_ROW_LENGTH,r.width),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.texImage3D(o,i,l,t,t,t,0,c,f,null);for(let n=0;n<a;++n){const a=n*t*u,l=n*t*s;e.pixelStorei(e.UNPACK_SKIP_PIXELS,a),e.pixelStorei(e.UNPACK_SKIP_ROWS,l),e.texSubImage3D(o,i,0,0,n,t,t,1,c,f,r)}J(e)}else e.texImage2D(o,i,l,c,f,r);q(e,n),re(n)&&te(e,t,n,a,u,l,f),ee(e,t,n)}function ae(){}function ue(e,t){return void 0!==t||function(e){if("undefined"!=typeof document){const t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}{const t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}(e)?t:"anonymous"}function le(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function se(e,t,r){return le(e)?(setTimeout(function(){r(null,e)}),e):function(e,t,r){let n;if(r=r||ae,t=void 0!==t?t:G.crossOrigin,t=ue(e,t),"undefined"!=typeof Image){n=new Image,void 0!==t&&(n.crossOrigin=t);const o=function(){n.removeEventListener("error",i),n.removeEventListener("load",a),n=null},i=function(){const t="couldn't load image: "+e;g(t),r(t,n),o()},a=function(){r(null,n),o()};return n.addEventListener("error",i),n.addEventListener("load",a),n.src=e,n}if("undefined"!=typeof ImageBitmap){let o,i;const a=function(){r(o,i)},u={};t&&(u.mode="cors"),fetch(e,u).then(function(e){if(!e.ok)throw e;return e.blob()}).then(function(e){return createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(e){i=e,setTimeout(a)}).catch(function(e){o=e,setTimeout(a)}),n=null}return n}(e,t,r)}function ce(e,t,r){const n=(r=r||G.textureOptions).target||e.TEXTURE_2D;if(e.bindTexture(n,t),!1===r.color)return;const o=function(e){return e=e||G.textureColor,z(e)?e:new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}(r.color);if(n===e.TEXTURE_CUBE_MAP)for(let t=0;t<6;++t)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);else n===e.TEXTURE_3D||n===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage2D(n,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o)}function fe(e,t,r,n){n=n||ae;const o=r.src;if(6!==o.length)throw"there must be 6 urls for a cubemap";const i=r.level||0,a=r.internalFormat||r.format||e.RGBA,u=Y(a),l=r.format||u.format,s=r.type||e.UNSIGNED_BYTE,c=r.target||e.TEXTURE_2D;if(c!==e.TEXTURE_CUBE_MAP)throw"target must be TEXTURE_CUBE_MAP";ce(e,t,r),r=Object.assign({},r);let f=6;const m=[],d=ne(e,r);let E;E=o.map(function(o,u){return se(o,r.crossOrigin,(b=d[u],function(o,u){--f,o?m.push(o):u.width!==u.height?m.push("cubemap face img is not a square: "+u.src):($(e,r),e.bindTexture(c,t),5===f?ne(e).forEach(function(t){e.texImage2D(t,i,a,l,s,u)}):e.texImage2D(b,i,a,l,s,u),q(e,r),re(r)&&e.generateMipmap(c)),0===f&&n(m.length?m:void 0,t,E)}));var b})}function me(e,t,r,n){n=n||ae;const o=r.src,i=r.internalFormat||r.format||e.RGBA,a=Y(i),u=r.format||a.format,l=r.type||e.UNSIGNED_BYTE,s=r.target||e.TEXTURE_2D_ARRAY;if(s!==e.TEXTURE_3D&&s!==e.TEXTURE_2D_ARRAY)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";ce(e,t,r),r=Object.assign({},r);let c=o.length;const f=[];let m;const d=r.level||0;let E=r.width,b=r.height;const y=o.length;let p=!0;m=o.map(function(o,a){return se(o,r.crossOrigin,(_=a,function(o,a){if(--c,o)f.push(o);else{if($(e,r),e.bindTexture(s,t),p){p=!1,E=r.width||a.width,b=r.height||a.height,e.texImage3D(s,d,i,E,b,y,0,u,l,null);for(let t=0;t<y;++t)e.texSubImage3D(s,d,0,0,t,E,b,1,u,l,a)}else{let t=a;a.width===E&&a.height===b||(t=X.canvas,X.canvas.width=E,X.canvas.height=b,X.drawImage(a,0,0,E,b)),e.texSubImage3D(s,d,0,0,_,E,b,1,u,l,t),t===X.canvas&&(X.canvas.width=0,X.canvas.height=0)}q(e,r),re(r)&&e.generateMipmap(s)}0===c&&n(f.length?f:void 0,t,m)}));var _})}function de(e,t,r,n){const o=(n=n||G.textureOptions).target||e.TEXTURE_2D;e.bindTexture(o,t);let i=n.width,a=n.height,u=n.depth;const l=n.level||0,s=n.internalFormat||n.format||e.RGBA,c=Y(s),f=n.format||c.format,m=n.type||function(e,t,r){return z(t)?R(t):r||e.UNSIGNED_BYTE}(e,r,c.type);if(z(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{const e=function(e){const t=A[e];if(!t)throw new Error("unknown gl type");return t}(m);r=new e(r)}const d=function(e,t){const r=K[e];if(!r)throw"unknown internal format";const n=r.bytesPerElementMap[t];if(void 0===n)throw"unknown internal format";return n}(s,m),E=r.byteLength/d;if(E%1)throw"length wrong size for format: "+D(e,f);let b;if(o===e.TEXTURE_3D)if(i||a||u)!i||a&&u?!a||i&&u?(b=V(e,o,i,a,E/u),i=b.width,a=b.height):(b=V(e,o,i,u,E/a),i=b.width,u=b.height):(b=V(e,o,a,u,E/i),a=b.width,u=b.height);else{const e=Math.cbrt(E);if(e%1!=0)throw"can't guess cube size of array of numElements: "+E;i=e,a=e,u=e}else b=V(e,o,i,a,E),i=b.width,a=b.height;if(Z(e),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment||1),$(e,n),o===e.TEXTURE_CUBE_MAP){const t=E/6*(d/r.BYTES_PER_ELEMENT);oe(e,n).forEach(n=>{const o=t*n.ndx,u=r.subarray(o,o+t);e.texImage2D(n.face,l,s,i,a,0,f,m,u)})}else o===e.TEXTURE_3D?e.texImage3D(o,l,s,i,a,u,0,f,m,r):e.texImage2D(o,l,s,i,a,0,f,m,r);return q(e,n),J(e),{width:i,height:a,depth:u,type:m}}function Ee(e,t,r){r=r||ae,t=t||G.textureOptions;const n=e.createTexture(),o=t.target||e.TEXTURE_2D;let i=t.width||1,a=t.height||1;const u=t.internalFormat||e.RGBA,l=Y(u);let s=t.type||l.type;e.bindTexture(o,n),o===e.TEXTURE_CUBE_MAP&&(e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE));let c=t.src;if(c)if("function"==typeof c&&(c=c(e,t)),"string"==typeof c)!function(e,t,r,n){n=n||ae,r=r||G.textureOptions,ce(e,t,r),se((r=Object.assign({},r)).src,r.crossOrigin,function(o,i){o?n(o,t,i):(ie(e,t,i,r),n(null,t,i))})}(e,n,t,r);else if(z(c)||Array.isArray(c)&&("number"==typeof c[0]||Array.isArray(c[0])||z(c[0]))){const r=de(e,n,c,t);i=r.width,a=r.height,s=r.type}else if(Array.isArray(c)&&("string"==typeof c[0]||le(c[0])))o===e.TEXTURE_CUBE_MAP?fe(e,n,t,r):me(e,n,t,r);else{if(!le(c))throw"unsupported src type";ie(e,n,c,t),i=c.width,a=c.height}else!function(e,t,r){const n=r.target||e.TEXTURE_2D;e.bindTexture(n,t);const o=r.level||0,i=r.internalFormat||r.format||e.RGBA,a=Y(i),u=r.format||a.format,l=r.type||a.type;if($(e,r),n===e.TEXTURE_CUBE_MAP)for(let t=0;t<6;++t)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,o,i,r.width,r.height,0,u,l,null);else n===e.TEXTURE_3D?e.texImage3D(n,o,i,r.width,r.height,r.depth,0,u,l,null):e.texImage2D(n,o,i,r.width,r.height,0,u,l,null);q(e,r)}(e,n,t);return re(t)&&te(e,n,t,i,a,u,s),ee(e,n,t),n}const be=g,ye="undefined"!=typeof document&&document.getElementById?document.getElementById.bind(document):function(){return null},pe={};function _e(e,t){return pe[t].bindPoint}function he(e,t){return function(r){e.uniform1i(t,r)}}function Te(e,t){return function(r){e.uniform1iv(t,r)}}function Ae(e,t){return function(r){e.uniform2iv(t,r)}}function Re(e,t){return function(r){e.uniform3iv(t,r)}}function xe(e,t){return function(r){e.uniform4iv(t,r)}}function ge(e,t,r,n){const o=_e(0,t);return O(e)?function(t){let i,a;P(0,t)?(i=t,a=null):(i=t.texture,a=t.sampler),e.uniform1i(n,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(o,i),e.bindSampler(r,a)}:function(t){e.uniform1i(n,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(o,t)}}function Fe(e,t,r,n,o){const i=_e(0,t),a=new Int32Array(o);for(let e=0;e<o;++e)a[e]=r+e;return O(e)?function(t){e.uniform1iv(n,a),t.forEach(function(t,n){let o,u;e.activeTexture(e.TEXTURE0+a[n]),P(0,t)?(o=t,u=null):(o=t.texture,u=t.sampler),e.bindSampler(r,u),e.bindTexture(i,o)})}:function(t){e.uniform1iv(n,a),t.forEach(function(t,r){e.activeTexture(e.TEXTURE0+a[r]),e.bindTexture(i,t)})}}function Pe(e,t){return function(r){if(r.value)switch(e.disableVertexAttribArray(t),r.value.length){case 4:e.vertexAttrib4fv(t,r.value);break;case 3:e.vertexAttrib3fv(t,r.value);break;case 2:e.vertexAttrib2fv(t,r.value);break;case 1:e.vertexAttrib1fv(t,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.numComponents||r.size,r.type||e.FLOAT,r.normalize||!1,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function ve(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an integer constant value must be 4!");e.vertexAttrib4iv(t,r.value)}else e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||e.INT,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function Ue(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");e.vertexAttrib4uiv(t,r.value)}else e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||e.UNSIGNED_INT,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function we(e,t,r){const n=r.size,o=r.count;return function(r){e.bindBuffer(e.ARRAY_BUFFER,r.buffer);const i=r.size||r.numComponents||n,a=i/o,u=r.type||e.FLOAT,l=pe[u].size*i,s=r.normalize||!1,c=r.offset||0,f=l/o;for(let n=0;n<o;++n)e.enableVertexAttribArray(t+n),e.vertexAttribPointer(t+n,a,u,s,l,c+f*n),void 0!==r.divisor&&e.vertexAttribDivisor(t+n,r.divisor)}}pe[5126]={Type:Float32Array,size:4,setter:function(e,t){return function(r){e.uniform1f(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1fv(t,r)}}},pe[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(r){e.uniform2fv(t,r)}}},pe[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(r){e.uniform3fv(t,r)}}},pe[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniform4fv(t,r)}}},pe[5124]={Type:Int32Array,size:4,setter:he,arraySetter:Te},pe[35667]={Type:Int32Array,size:8,setter:Ae},pe[35668]={Type:Int32Array,size:12,setter:Re},pe[35669]={Type:Int32Array,size:16,setter:xe},pe[5125]={Type:Uint32Array,size:4,setter:function(e,t){return function(r){e.uniform1ui(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1uiv(t,r)}}},pe[36294]={Type:Uint32Array,size:8,setter:function(e,t){return function(r){e.uniform2uiv(t,r)}}},pe[36295]={Type:Uint32Array,size:12,setter:function(e,t){return function(r){e.uniform3uiv(t,r)}}},pe[36296]={Type:Uint32Array,size:16,setter:function(e,t){return function(r){e.uniform4uiv(t,r)}}},pe[35670]={Type:Uint32Array,size:4,setter:he,arraySetter:Te},pe[35671]={Type:Uint32Array,size:8,setter:Ae},pe[35672]={Type:Uint32Array,size:12,setter:Re},pe[35673]={Type:Uint32Array,size:16,setter:xe},pe[35674]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}}},pe[35675]={Type:Float32Array,size:36,setter:function(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}}},pe[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}}},pe[35685]={Type:Float32Array,size:24,setter:function(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}}},pe[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}}},pe[35687]={Type:Float32Array,size:24,setter:function(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}}},pe[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}}},pe[35689]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}}},pe[35690]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}}},pe[35678]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:3553},pe[35680]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:34067},pe[35679]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:32879},pe[35682]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:3553},pe[36289]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:35866},pe[36292]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:35866},pe[36293]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:34067},pe[36298]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:3553},pe[36299]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:32879},pe[36300]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:34067},pe[36303]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:35866},pe[36306]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:3553},pe[36307]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:32879},pe[36308]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:34067},pe[36311]={Type:null,size:0,setter:ge,arraySetter:Fe,bindPoint:35866};const Ie={};Ie[5126]={size:4,setter:Pe},Ie[35664]={size:8,setter:Pe},Ie[35665]={size:12,setter:Pe},Ie[35666]={size:16,setter:Pe},Ie[5124]={size:4,setter:ve},Ie[35667]={size:8,setter:ve},Ie[35668]={size:12,setter:ve},Ie[35669]={size:16,setter:ve},Ie[5125]={size:4,setter:Ue},Ie[36294]={size:8,setter:Ue},Ie[36295]={size:12,setter:Ue},Ie[36296]={size:16,setter:Ue},Ie[35670]={size:4,setter:ve},Ie[35671]={size:8,setter:ve},Ie[35672]={size:12,setter:ve},Ie[35673]={size:16,setter:ve},Ie[35674]={size:4,setter:we,count:2},Ie[35675]={size:9,setter:we,count:3},Ie[35676]={size:16,setter:we,count:4};const Se=/^[ \t]*\n/;function Be(e,t,r,n){const o=n||be,i=e.createShader(r);let a=0;if(Se.test(t)&&(a=1,t=t.replace(Se,"")),e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){const r=e.getShaderInfoLog(i);return o(function(e,t){return t=t||0,++t,e.split("\n").map(function(e,r){return r+t+": "+e}).join("\n")}(t,a)+"\n*** Error compiling shader: "+r),e.deleteShader(i),null}return i}function Le(e,t,r){let n;if("function"==typeof t&&(r=t,t=void 0),"function"==typeof e)r=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;const t=e;r=t.errorCallback,e=t.attribLocations,n=t.transformFeedbackVaryings}const o={errorCallback:r||be,transformFeedbackVaryings:n};if(e){let r={};Array.isArray(e)?e.forEach(function(e,n){r[e]=t?t[n]:n}):r=e,o.attribLocations=r}return o}const Me=["VERTEX_SHADER","FRAGMENT_SHADER"];function Ce(e,t){return t.indexOf("frag")>=0?e.FRAGMENT_SHADER:t.indexOf("vert")>=0?e.VERTEX_SHADER:void 0}function Ne(e,t){t.forEach(function(t){e.deleteShader(t)})}function Oe(e,t,r,n,o){const i=Le(r,n,o),a=[];for(let r=0;r<t.length;++r){const n=Be(e,t[r],e[Me[r]],i.errorCallback);if(!n)return null;a.push(n)}return function(e,t,r,n,o){const i=Le(r,n,o),a=[],u=[];for(let r=0;r<t.length;++r){let n=t[r];if("string"==typeof n){const t=ye(n),o=t?t.text:n;let a=e[Me[r]];t&&t.type&&(a=Ce(e,t.type)||a),n=Be(e,o,a,i.errorCallback),u.push(n)}l=n,"undefined"!=typeof WebGLShader&&l instanceof WebGLShader&&a.push(n)}var l;if(a.length!==t.length)return i.errorCallback("not enough shaders for program"),Ne(e,u),null;const s=e.createProgram();a.forEach(function(t){e.attachShader(s,t)}),i.attribLocations&&Object.keys(i.attribLocations).forEach(function(t){e.bindAttribLocation(s,i.attribLocations[t],t)});let c=i.transformFeedbackVaryings;if(c&&(c.attribs&&(c=c.attribs),Array.isArray(c)||(c=Object.keys(c)),e.transformFeedbackVaryings(s,c,i.transformFeedbackMode||e.SEPARATE_ATTRIBS)),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){const t=e.getProgramInfoLog(s);return i.errorCallback("Error in program linking:"+t),e.deleteProgram(s),Ne(e,u),null}return s}(e,a,i)}function De(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function Ge(e,t){const r={program:t,uniformSetters:function(e,t){let r=0;function n(t,n){const o=e.getUniformLocation(t,n.name),i=n.size>1&&"[0]"===n.name.substr(-3),a=n.type,u=pe[a];if(!u)throw new Error(`unknown type: 0x${a.toString(16)}`);let l;if(u.bindPoint){const t=r;r+=n.size,l=i?u.arraySetter(e,a,t,o,n.size):u.setter(e,a,t,o,n.size)}else l=u.arraySetter&&i?u.arraySetter(e,o):u.setter(e,o);return l.location=o,l}const o={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const i=e.getActiveUniform(t,r);if(De(i))continue;let a=i.name;"[0]"===a.substr(-3)&&(a=a.substr(0,a.length-3));const u=n(t,i);o[a]=u}return o}(e,t),attribSetters:function(e,t){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let o=0;o<n;++o){const n=e.getActiveAttrib(t,o);if(De(n))continue;const i=e.getAttribLocation(t,n.name),a=Ie[n.type],u=a.setter(e,i,a);u.location=i,r[n.name]=u}return r}(e,t)};return O(e)&&(r.uniformBlockSpec=function(e,t){const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=[],o=[];for(let i=0;i<r;++i){o.push(i),n.push({});const r=e.getActiveUniform(t,i);if(De(r))break;n[i].name=r.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(r){const i=r[0],a=r[1];e.getActiveUniforms(t,o,e[i]).forEach(function(e,t){n[t][a]=e})});const i={},a=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS);for(let r=0;r<a;++r){const n=e.getActiveUniformBlockName(t,r),o={index:r,usedByVertexShader:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_DATA_SIZE),uniformIndices:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)};o.used=o.usedByVertexShader||o.usedByFragmentShader,i[n]=o}return{blockSpecs:i,uniformData:n}}(e,t),r.transformFeedbackInfo=function(e,t){const r={},n=e.getProgramParameter(t,e.TRANSFORM_FEEDBACK_VARYINGS);for(let o=0;o<n;++o){const n=e.getTransformFeedbackVarying(t,o);r[n.name]={index:o,type:n.type,size:n.size}}return r}(e,t)),r}const ze=36064,Xe=[{format:6408,type:5121,min:9729,wrap:33071},{format:34041}],ke={};ke[34041]=33306,ke[6401]=36128,ke[36168]=36128,ke[6402]=36096,ke[33189]=36096;const We={};function Ke(e,t,r,n){const o=e.FRAMEBUFFER,i=e.createFramebuffer();e.bindFramebuffer(o,i),r=r||e.drawingBufferWidth,n=n||e.drawingBufferHeight;let a=0;const u={framebuffer:i,attachments:[],width:r,height:n};return(t=t||Xe).forEach(function(t){let i=t.attachment;const l=t.format;let s=function(e){return ke[e]}(l);if(s||(s=ze+a++),!i)if(function(e){return We[e]}(l))i=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,l,r,n);else{const o=Object.assign({},t);o.width=r,o.height=n,void 0===o.auto&&(o.auto=!1,o.min=o.min||o.minMag||e.LINEAR,o.mag=o.mag||o.minMag||e.LINEAR,o.wrapS=o.wrapS||o.wrap||e.CLAMP_TO_EDGE,o.wrapT=o.wrapT||o.wrap||e.CLAMP_TO_EDGE),i=Ee(e,o)}if(c=i,"undefined"!=typeof WebGLRenderbuffer&&c instanceof WebGLRenderbuffer)e.framebufferRenderbuffer(o,s,e.RENDERBUFFER,i);else{if(!P(0,i))throw new Error("unknown attachment type");void 0!==t.layer?e.framebufferTextureLayer(o,s,i,t.level||0,t.layer):e.framebufferTexture2D(o,s,t.texTarget||e.TEXTURE_2D,i,t.level||0)}var c;u.attachments.push(i)}),u}We[32854]=!0,We[32855]=!0,We[36194]=!0,We[34041]=!0,We[33189]=!0,We[6401]=!0,We[36168]=!0;const Ye=/^(.*?)_/;function He(e,t){D(e,0);const r=e.getExtension(t);if(r){const n={},o=Ye.exec(t)[1],i="_"+o;for(const t in r){const a=r[t],u="function"==typeof a,l=u?o:i;let s=t;t.endsWith(l)&&(s=t.substring(0,t.length-l.length)),void 0!==e[s]?u||e[s]===a||F(s,e[s],a,t):u?e[s]=function(e){return function(){return e.apply(r,arguments)}}(a):(e[s]=a,n[s]=a)}n.constructor={name:r.constructor.name},D(n,0)}return r}const Ve=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];const je=200,$e=200,qe=1;let Ze,Je;const Qe={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]},et=[0,0,1];let tt;function rt(t,r,o){return e(this,void 0,void 0,function*(){if(Ze=document.getElementById("c"),!(Je=Ze.getContext("webgl2")))return void(document.children[0].innerHTML="This browser has no WebGL2 support or it is not turned on.");!function(e){for(let t=0;t<Ve.length;++t)He(e,Ve[t])}(Je);const e=["noise-f","simple-geo-v","star-f","raymarch-f","lattice-v","geo-f","quad-v","light-f","screen-f"],i=yield Promise.all(e.map(e=>{let t=document.getElementById(`${e}.glsl`);return t?t.innerHTML:document.getElementById(`${e}.glsl`)||function(e,t="text"){return new Promise(r=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType=t,n.onload=(()=>r(n.response)),n.send()})}(`./shaders/${e}.glsl`)})),[u,l,s,E,b,y,p,_,h]=(i.reduce((t,r,n)=>(t[e[n]]=r,t),{}),i),T=[Ze.clientWidth*qe,Ze.clientHeight*qe],A=Ee(Je,{width:T[0],height:T[1],internalFormat:Je.DEPTH24_STENCIL8}),R=Ee(Je,{width:T[0],height:T[1],internalFormat:Je.RGB,min:Je.NEAREST});let x=function(e){let t=$e*$e*$e,r=Math.ceil(Math.sqrt(t));const n={programs:e,source:N(Je,Qe),uniforms:{u_resolution:$e,u_side:r},target:Ke(Je,[{internalFormat:Je.R32F}],r,r)};Je.drawBuffers([Je.COLOR_ATTACHMENT0]),nt(Je,n),Je.flush();const o=new Float32Array(r*r);return Je.readBuffer(Je.COLOR_ATTACHMENT0),Je.readPixels(0,0,r,r,Je.RED,Je.FLOAT,o),Ee(Je,{target:Je.TEXTURE_3D,width:$e,height:$e,depth:$e,wrap:Je.MIRRORED_REPEAT,minMag:Je.LINEAR,internalFormat:Je.R16F,src:o.slice(0,t)})}([p,u]);const g={programs:[p,E],source:N(Je,Qe),target:Ke(Je,[{internalFormat:Je.RGBA16F},{attachment:R},{format:Je.DEPTH_STENCIL,attachment:A}],T[0],T[1])};Je.enable(Je.DEPTH_TEST),Je.drawBuffers([Je.COLOR_ATTACHMENT0,Je.COLOR_ATTACHMENT1]);let F={color:{size:1,data:[...new Array(6)].map((e,t)=>0)},position:Qe.position.map(e=>1e3*e+500)};console.log(F);N(Je,F),g.target;const P={programs:[p,_],uniforms:{u_color:g.target.attachments[0],u_normal:g.target.attachments[1],u_depth:g.target.attachments[2]},source:N(Je,Qe),target:Ke(Je,[{internalFormat:Je.RGBA16F}],T[0],T[1])};Je.drawBuffers([Je.COLOR_ATTACHMENT0]);const v={programs:[p,h],uniforms:{u_color:P.target.attachments[0],u_bufferSize:T},source:N(Je,Qe)};!function(e,t){t=t||1,t=Math.max(0,t);const r=e.clientWidth*t|0,n=e.clientHeight*t|0;(e.width!==r||e.height!==n)&&(e.width=r,e.height=n)}(Ze),Je.viewport(0,0,Ze.clientWidth,Ze.clientHeight);let U=new Int32Array(100);tt=((e,i,u)=>{const l=function(e,t,r,n,o){o=o||new a(16);const i=1/Math.tan(.5*e),u=1/(r-n);return o[0]=i/t,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(r+n)*u,o[11]=-1,o[12]=0,o[13]=0,o[14]=r*n*u*2,o[15]=0,o}(40*Math.PI/180,Ze.clientWidth/Ze.clientHeight,.5,800),s=d(i,n(i,u),et),E=f(m(l,f(d([0,0,0],u,et)))),b=m(l,f(s)),y=f(b),p=function(e){return(e=e||new a(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}();for(let e=0;e<U.length;e++)U[e]=0;for(let e=0;e<o.length;e++){let t=Math.floor(e/16);o[e]&&(U[t]=U[t]+(1<<e%16))}const _={"u_light[0].pos":[1300,1e3,2e3],"u_light[0].color":[1,1,1,1],u_ambient:[1,1,1,.3],u_specular:[1,1,1,5],u_shininess:50,u_time:e,u_orbRadius:1+.2*Math.sin(3*e),u_eye:i,u_resolution:je,u_scale:100,u_depthRange:[.5,800],u_bufferSize:T,u_viewInverse:s,u_world:p,u_worldInverseTranspose:c(f(p)),u_worldViewProjection:b,u_inverseWorldViewProjection:y,u_raycastProjection:E,u_collected:U,u_noise:x};Object.assign(P.uniforms,_),g.uniforms=_,nt(Je,g),Je.flush();const h=new Float32Array(4);Je.readBuffer(Je.COLOR_ATTACHMENT0),Je.readPixels(0,0,1,1,Je.RGBA,Je.FLOAT,h),h[0]?t():h[1]&&r(h[1]),nt(Je,P),nt(Je,v)})})}function nt(e,t){!function(e,t,r){r=r||e.FRAMEBUFFER,t?(e.bindFramebuffer(r,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(r,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}(e,t.target),t.overwrite||e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),t.programInfo||(t.programInfo=function(e,t,r,n,o){const i=Le(r,n,o);let a=!0;if(t=t.map(function(e){if(e.indexOf("\n")<0){const t=ye(e);t?e=t.text:(i.errorCallback("no element with id: "+e),a=!1)}return e}),!a)return null;const u=Oe(e,t,i);return u?Ge(e,u):null}(e,t.programs,e=>console.log(e)));const r=t.programInfo;e.useProgram(r.program),function(e,t,r){r.vertexArrayObject?e.bindVertexArray(r.vertexArrayObject):(function(e,t){for(const r in t){const n=e[r];n&&n(t[r])}}(t.attribSetters||t,r.attribs),r.indices&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indices))}(e,r,t.source),function e(t,r){const n=t.uniformSetters||t,o=arguments.length;for(let t=1;t<o;++t){const r=arguments[t];if(Array.isArray(r)){const t=r.length;for(let o=0;o<t;++o)e(n,r[o])}else for(const e in r){const t=n[e];t&&t(r[e])}}}(r,t.uniforms),function(e,t,r,n,o,i){r=void 0===r?e.TRIANGLES:r;const a=t.indices,u=t.elementType,l=void 0===n?t.numElements:n;o=void 0===o?0:o,u||a?void 0!==i?e.drawElementsInstanced(r,l,void 0===u?e.UNSIGNED_SHORT:t.elementType,o,i):e.drawElements(r,l,void 0===u?e.UNSIGNED_SHORT:t.elementType,o):void 0!==i?e.drawArraysInstanced(r,o,l,i):e.drawArrays(r,o,l)}(e,t.source),t.then&&t.then()}class ot{constructor(e){this.interval=100,this.pressed={},this.subs=[],e.addEventListener("keydown",this),e.addEventListener("keyup",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this)}handleEvent(e){let t,r;e instanceof KeyboardEvent?(t=e.code,r="keydown"==e.type?"down":"up"):(t="Click"+e.button,r="mousedown"==e.type?"down":"up"),"down"==r&&(t in this.pressed||(this.click(t),this.pressed[t]=window.setInterval(()=>this.click(t),this.interval))),"up"==r&&(window.clearInterval(this.pressed[t]),delete this.pressed[t])}click(e){for(let t of this.subs)t(e)}sub(e){this.subs.push(e)}unsub(e){this.subs=this.subs.filter(t=>t!=e)}once(e){let t=r=>{this.unsub(t),e(r)};this.sub(t)}isPressed(e){return e in this.pressed}clear(){this.subs=[]}}let it,at=1,ut={playerExplode:[10,.1,0,.8,.05,.7,4.6,21.2,.4],explode:[30,.1,1811,.8,.01,1.9,3,.5,.04],powerup:[10,.1,240,.2,.85,5.7,.8,0,.77],shieldDest:[10,.1,1750,.7,.05,.1,1.8,.3,.18],blast:[10,.1,5e3,1.7,.01,0,4,0,.45],ponk:[.5,.1,1549,.1,0,0,1.2,48.9,.17],boom:[10,.1,3e3,1.5,.01,0,4,0,.48],rumble:[10,.1,200,.7,.1,0,5,.1,.36],sad:[10,.1,264,1.1,.53,0,0,.1,.94],vwom:[10,.1,1,1,.11,0,0,69.2,.95],pop:[10,.1,21,.1,.46,9,.1,5.7,.12],swipe:[10,.1,866,.1,.5,0,1.6,.4,.98],ow:[10,.1,1682,.2,.66,3,0,1.2,.69],wave:[10,.1,1825,1,.2,0,5,.2,.3],bobbleUp:[5,.1,17,1,.26,.2,.1,8,.66]};function lt(e){it||(it=function(){let e=new AudioContext;return(t,r,n,o=1,i=.1,a=0,u=0,l=0,s=0)=>{let c=44100,f=Math.PI;n*=2*f/c,n*=1+r*(2*Math.random()-1),a*=1e3*f/c**2,i*=0|(o=0<o?c*(10<o?10:o)|0:1),l*=2*f/c,s*=f,r=[];for(var m=0,d=0,E=0;E<o;++E)r[E]=.5*t*Math.cos(m*n*Math.cos(d*l+s))*(E<i?E/i:1-(E-i)/(o-i)),m+=1+u*(2*Math.random()-1),d+=1+u*(2*Math.random()-1),n+=a;return t=e.createBuffer(1,o,c),n=e.createBufferSource(),t.getChannelData(0).set(r),n.buffer=t,n.connect(e.destination),n.start(),n}}()),it(ut[e][0]*at,...ut[e].slice(1))}let st,ct,ft,mt,dt,Et=Math.PI/180,bt=0,yt=new Uint8Array(1e3),pt=0,_t=[];const ht=[600,300,250],Tt=30,At=300,Rt=.3,xt=.03,gt=10,Ft=10,Pt=100;function vt(){return document.pointerLockElement==Ze&&!Ut()}function Ut(){return pt>=Pt}function wt(){console.log("crash"),lt("bobbleUp"),0==(pt=Math.max(0,pt-5))&&(bt=0),st[2]=300,ct=Tt}function It(e){yt[e]||(lt("ponk"),pt++,ct+=gt,e>=0&&(yt[e]=1),_t.push({pos:st,time:bt,orb:e,vel:ct,rot:ft}))}const St=3;window.onload=(r=>e(void 0,void 0,void 0,function*(){yield rt(wt,It,yt);let e=document.getElementById("stats"),r=document.getElementById("orbs"),o=document.getElementById("pause"),a=document.getElementById("win");const u=new ot(document);document.addEventListener("keydown",e=>{"Space"==e.code&&(vt()?document.exitPointerLock():Ze.requestPointerLock()),"KeyR"!=e.code||function(e=-1){e<0&&(e=St);let t=Math.max(1,_t.length-St),r=(_t=_t.slice(0,t))[_t.length-1];yt=new Uint8Array(1e3),pt=0;for(let e of _t)e.orb>=0&&pt++,yt[e.orb]=1;st=r.pos,bt=r.time,ct=r.vel,ft=r.rot,dt=ft.slice(),mt=[0,0]}(1e6)}),Ze.addEventListener("mousedown",e=>{vt()?(0==e.button&&pt>0&&(pt--,ct+=30),2==e.button&&(ct=Math.max(ct-30,2*Ft))):Ze.requestPointerLock()}),Ze.addEventListener("mousemove",e=>{mt[0]=e.movementX,mt[1]=e.movementY});let l=0;ct=Tt,st=ht,ft=[0,0],dt=[0,0],mt=[0,0];let s=[1,0,0];!function(e=-1){_t.push({pos:st,time:bt,orb:e,vel:ct,rot:ft})}();let c=0;window.requestAnimationFrame(function f(m){if(o.style.visibility=vt()||Ut()?"hidden":"visible",a.style.visibility=Ut()?"visible":"hidden",Ut())return void(a.innerHTML=`<h2>Congaturaleishuns!</h2> You have collected <b>${pt}</b> orbs in <b>${Math.floor(bt)} seconds!</b><br/><br/> Press <b>R</b> to restart.`);if(!vt()&&c>0)return void window.requestAnimationFrame(f);let d=(m-l)/1e3;d>.1&&(d=.1),l=m,bt+=d,mt=mt.map(e=>Math.sign(e)*Math.min(30,Math.abs(e)*d*60)),ft[0]=ft[0]-.1*mt[0],ft[1]=Math.max(-90,Math.min(90,ft[1]-.1*mt[1]));let E=Math.min(1,60*d);dt=dt.map((e,t)=>e*(1-E)+ft[t]*E);let[b,y]=dt.map(e=>e*Et);if(s=i([Math.cos(y)*Math.cos(b),Math.cos(y)*Math.sin(b),Math.sin(y)]),mt=[0,0],u.pressed.KeyO&&(ct+=At*d),u.pressed.KeyL&&(ct=Math.max(0,ct-At*d)),(ct*=1-xt*d)<=Ft){let e=Ft-ct/100;st[2]-=e*Rt,ct+=e}let p=(_=s,h=ct*d,(T=T||new t(3))[0]=_[0]*h,T[1]=_[1]*h,T[2]=_[2]*h,T);var _,h,T;ct-=p[2]*Rt,st=n(st,p),e.innerText=`Time: ${Math.floor(bt)} Position: ${st.map(e=>Math.round(e)).join(",")} Velocity: ${Math.floor(ct)}`,r.innerText=`Orbs: ${pt}/${Pt}`,tt(bt,st,s),c++,window.requestAnimationFrame(f)})}))}();
