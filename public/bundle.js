!function(){"use strict";function e(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function u(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}l((n=n.apply(e,t||[])).next())})}let t=Float32Array;function r(e,r,n){const o=new t(3);return e&&(o[0]=e),r&&(o[1]=r),n&&(o[2]=n),o}function n(e,r,n){return(n=n||new t(3))[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function o(e,r,n){return(n=n||new t(3))[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function i(e,r,n){n=n||new t(3);const o=e[2]*r[0]-e[0]*r[2],i=e[0]*r[1]-e[1]*r[0];return n[0]=e[1]*r[2]-e[2]*r[1],n[1]=o,n[2]=i,n}function a(e,r){r=r||new t(3);const n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],o=Math.sqrt(n);return o>1e-5?(r[0]=e[0]/o,r[1]=e[1]/o,r[2]=e[2]/o):(r[0]=0,r[1]=0,r[2]=0),r}let u=Float32Array;const l=r(),s=r(),c=r();function f(e,t){if((t=t||new u(16))===e){let r;return r=e[1],e[1]=e[4],e[4]=r,r=e[2],e[2]=e[8],e[8]=r,r=e[3],e[3]=e[12],e[12]=r,r=e[6],e[6]=e[9],e[9]=r,r=e[7],e[7]=e[13],e[13]=r,r=e[11],e[11]=e[14],e[14]=r,t}const r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],l=e[5],s=e[6],c=e[7],f=e[8],m=e[9],E=e[10],d=e[11],y=e[12],b=e[13],p=e[14],_=e[15];return t[0]=r,t[1]=a,t[2]=f,t[3]=y,t[4]=n,t[5]=l,t[6]=m,t[7]=b,t[8]=o,t[9]=s,t[10]=E,t[11]=p,t[12]=i,t[13]=c,t[14]=d,t[15]=_,t}function m(e,t){t=t||new u(16);const r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],l=e[5],s=e[6],c=e[7],f=e[8],m=e[9],E=e[10],d=e[11],y=e[12],b=e[13],p=e[14],_=e[15],h=E*_,A=p*d,T=s*_,R=p*c,x=s*d,g=E*c,F=o*_,P=p*i,v=o*d,U=E*i,w=o*c,I=s*i,S=f*b,B=y*m,L=a*b,M=y*l,N=a*m,C=f*l,O=r*b,D=y*n,G=r*m,z=f*n,X=r*l,k=a*n,W=h*l+R*m+x*b-(A*l+T*m+g*b),K=A*n+F*m+U*b-(h*n+P*m+v*b),Y=T*n+P*l+w*b-(R*n+F*l+I*b),H=g*n+v*l+I*m-(x*n+U*l+w*m),V=1/(r*W+a*K+f*Y+y*H);return t[0]=V*W,t[1]=V*K,t[2]=V*Y,t[3]=V*H,t[4]=V*(A*a+T*f+g*y-(h*a+R*f+x*y)),t[5]=V*(h*r+P*f+v*y-(A*r+F*f+U*y)),t[6]=V*(R*r+F*a+I*y-(T*r+P*a+w*y)),t[7]=V*(x*r+U*a+w*f-(g*r+v*a+I*f)),t[8]=V*(S*c+M*d+N*_-(B*c+L*d+C*_)),t[9]=V*(B*i+O*d+z*_-(S*i+D*d+G*_)),t[10]=V*(L*i+D*c+X*_-(M*i+O*c+k*_)),t[11]=V*(C*i+G*c+k*d-(N*i+z*c+X*d)),t[12]=V*(L*E+C*p+B*s-(N*p+S*s+M*E)),t[13]=V*(G*p+S*o+D*E-(O*E+z*p+B*o)),t[14]=V*(O*s+k*p+M*o-(X*p+L*o+D*s)),t[15]=V*(X*E+N*o+z*s-(G*s+k*E+C*o)),t}function E(e,t,r){r=r||new u(16);const n=e[0],o=e[1],i=e[2],a=e[3],l=e[4],s=e[5],c=e[6],f=e[7],m=e[8],E=e[9],d=e[10],y=e[11],b=e[12],p=e[13],_=e[14],h=e[15],A=t[0],T=t[1],R=t[2],x=t[3],g=t[4],F=t[5],P=t[6],v=t[7],U=t[8],w=t[9],I=t[10],S=t[11],B=t[12],L=t[13],M=t[14],N=t[15];return r[0]=n*A+l*T+m*R+b*x,r[1]=o*A+s*T+E*R+p*x,r[2]=i*A+c*T+d*R+_*x,r[3]=a*A+f*T+y*R+h*x,r[4]=n*g+l*F+m*P+b*v,r[5]=o*g+s*F+E*P+p*v,r[6]=i*g+c*F+d*P+_*v,r[7]=a*g+f*F+y*P+h*v,r[8]=n*U+l*w+m*I+b*S,r[9]=o*U+s*w+E*I+p*S,r[10]=i*U+c*w+d*I+_*S,r[11]=a*U+f*w+y*I+h*S,r[12]=n*B+l*L+m*M+b*N,r[13]=o*B+s*L+E*M+p*N,r[14]=i*B+c*L+d*M+_*N,r[15]=a*B+f*L+y*M+h*N,r}function d(e,r,n,o){o=o||new u(16);const f=l,m=s,E=c;return a(function(e,r,n){return(n=n||new t(3))[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}(e,r,E),E),a(i(n,E,f),f),a(i(E,f,m),m),o[0]=f[0],o[1]=f[1],o[2]=f[2],o[3]=0,o[4]=m[0],o[5]=m[1],o[6]=m[2],o[7]=0,o[8]=E[0],o[9]=E[1],o[10]=E[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}const y=5120,b=5121,p=5122,_=5123,h=5124,A=5125,T=5126,R={};{const e=R;e[y]=Int8Array,e[b]=Uint8Array,e[p]=Int16Array,e[_]=Uint16Array,e[h]=Int32Array,e[A]=Uint32Array,e[T]=Float32Array,e[32819]=Uint16Array,e[32820]=Uint16Array,e[33635]=Uint16Array,e[5131]=Uint16Array,e[33640]=Uint32Array,e[35899]=Uint32Array,e[35902]=Uint32Array,e[36269]=Uint32Array,e[34042]=Uint32Array}function x(e){if(e instanceof Int8Array)return y;if(e instanceof Uint8Array)return b;if(e instanceof Uint8ClampedArray)return b;if(e instanceof Int16Array)return p;if(e instanceof Uint16Array)return _;if(e instanceof Int32Array)return h;if(e instanceof Uint32Array)return A;if(e instanceof Float32Array)return T;throw new Error("unsupported typed array type")}const g="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer},F="undefined"!=typeof console&&console.error&&"function"==typeof console.error?console.error.bind(console):function(){},P="undefined"!=typeof console&&console.warn&&"function"==typeof console.warn?console.warn.bind(console):function(){};function v(e,t){return"undefined"!=typeof WebGLTexture&&t instanceof WebGLTexture}const U={attribPrefix:""};function w(e,t,r,n){if(o=t,"undefined"!=typeof WebGLBuffer&&o instanceof WebGLBuffer)return t;var o;r=r||e.ARRAY_BUFFER;const i=e.createBuffer();return function(e,t,r,n,o){e.bindBuffer(t,r),e.bufferData(t,n,o||e.STATIC_DRAW)}(e,r,i,t,n),i}function I(e){return"indices"===e}const S=/coord|texture/i,B=/color|colour/i;function L(e,t){let r;if(t%(r=S.test(e)?2:B.test(e)?4:3)>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${r} but ${t} values is not evenly divisible by ${r}. You should specify it.`);return r}function M(e,t){if(g(e))return e;if(g(e.data))return e.data;Array.isArray(e)&&(e={data:e});let r=e.type;return r||(r=I(t)?Uint16Array:Float32Array),new r(e.data)}function N(e,t){const r={};return Object.keys(t).forEach(function(n){if(!I(n)){const i=t[n],a=i.attrib||i.name||i.attribName||U.attribPrefix+n;if(i.value){if(!Array.isArray(i.value)&&!g(i.value))throw new Error("array.value is not array or typedarray");r[a]={value:i.value}}else{let t,u,l,s;if(i.buffer&&i.buffer instanceof WebGLBuffer)t=i.buffer,s=i.numComponents||i.size,u=i.type,l=i.normalize;else if("number"==typeof i||"number"==typeof i.data){const r=i.data||i,a=i.type||Float32Array,c=r*a.BYTES_PER_ELEMENT;u=function(e){if(e===Int8Array)return y;if(e===Uint8Array)return b;if(e===Uint8ClampedArray)return b;if(e===Int16Array)return p;if(e===Uint16Array)return _;if(e===Int32Array)return h;if(e===Uint32Array)return A;if(e===Float32Array)return T;throw new Error("unsupported typed array type")}(a),l=void 0!==i.normalize?i.normalize:(o=a)===Int8Array||o===Uint8Array,s=i.numComponents||i.size||L(n,r),t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,c,i.drawType||e.STATIC_DRAW)}else{const r=M(i,n);t=w(e,r,void 0,i.drawType),u=x(r),l=void 0!==i.normalize?i.normalize:function(e){return e instanceof Int8Array||e instanceof Uint8Array}(r),s=function(e,t){return e.numComponents||e.size||L(t,function(e){return e.length?e:e.data}(e).length)}(i,n)}r[a]={buffer:t,numComponents:s,type:u,normalize:l,stride:i.stride||0,offset:i.offset||0,divisor:void 0===i.divisor?void 0:i.divisor,drawType:i.drawType}}}var o}),e.bindBuffer(e.ARRAY_BUFFER,null),r}const C=["position","positions","a_position"];function O(e,t,r){const n=N(e,t),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},n);const i=t.indices;if(i){const t=M(i,"indices");o.indices=w(e,t,e.ELEMENT_ARRAY_BUFFER),o.numElements=t.length,o.elementType=x(t)}else o.numElements||(o.numElements=function(e,t){let r,n;for(n=0;n<C.length&&!((r=C[n])in t)&&!((r=U.attribPrefix+r)in t);++n);n===C.length&&(r=Object.keys(t)[0]);const o=t[r];e.bindBuffer(e.ARRAY_BUFFER,o.buffer);const i=e.getBufferParameter(e.ARRAY_BUFFER,e.BUFFER_SIZE);e.bindBuffer(e.ARRAY_BUFFER,null);const a=i/function(e,t){return t===e.BYTE?1:t===e.UNSIGNED_BYTE?1:t===e.SHORT?2:t===e.UNSIGNED_SHORT?2:t===e.INT?4:t===e.UNSIGNED_INT?4:t===e.FLOAT?4:0}(e,o.type),u=o.numComponents||o.size,l=a/u;if(l%1!=0)throw new Error(`numComponents ${u} not correct for length ${length}`);return l}(e,o.attribs));return o}function D(e){return!!e.texStorage2D}const G=function(){const e={},t={};return function(r,n){return function(r){const n=r.constructor.name;if(!e[n]){for(const e in r)if("number"==typeof r[e]){const n=t[r[e]];t[r[e]]=n?`${n} | ${e}`:e}e[n]=!0}}(r),t[n]||"0x"+n.toString(16)}}(),z={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},X=g,k="undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null,W=6407,K=33319,Y={};{const e=Y;e[6406]={textureFormat:6406,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},e[6409]={textureFormat:6409,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},e[6410]={textureFormat:6410,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[5121,5131,36193,5126]},e[W]={textureFormat:W,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[5121,5131,36193,5126,33635]},e[6408]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[5121,5131,36193,5126,32819,32820]},e[33321]={textureFormat:6403,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[5121]},e[36756]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[5120]},e[33325]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[5126,5131]},e[33326]={textureFormat:6403,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[5126]},e[33330]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5121]},e[33329]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5120]},e[33332]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5123]},e[33331]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5122]},e[33334]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},e[33333]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5124]},e[33323]={textureFormat:K,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[5121]},e[36757]={textureFormat:K,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[5120]},e[33327]={textureFormat:K,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[5126,5131]},e[33328]={textureFormat:K,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[5126]},e[33336]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5121]},e[33335]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5120]},e[33338]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5123]},e[33337]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5122]},e[33340]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5125]},e[33339]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5124]},e[32849]={textureFormat:W,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[5121]},e[35905]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5121]},e[36194]={textureFormat:W,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[5121,33635]},e[36758]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5120]},e[35898]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35899]},e[35901]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35902]},e[34843]={textureFormat:W,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[5126,5131]},e[34837]={textureFormat:W,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5126]},e[36221]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5121]},e[36239]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5120]},e[36215]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5123]},e[36233]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5122]},e[36209]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5125]},e[36227]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5124]},e[32856]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},e[35907]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},e[36759]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[5120]},e[32855]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[5121,32820,33640]},e[32854]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[5121,32819]},e[32857]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[33640]},e[34842]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[5126,5131]},e[34836]={textureFormat:6408,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[5126]},e[36220]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5121]},e[36238]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5120]},e[36975]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[33640]},e[36214]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5123]},e[36232]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5122]},e[36226]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5124]},e[36208]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5125]},e[33189]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[5123,5125]},e[33190]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},e[36012]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5126]},e[35056]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[34042]},e[36013]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[36269]},Object.keys(e).forEach(function(t){const r=e[t];r.bytesPerElementMap={},r.bytesPerElement.forEach(function(e,t){const n=r.type[t];r.bytesPerElementMap[n]=e})})}function H(e){const t=Y[e];if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function V(e){return 0==(e&e-1)}function j(e,t,r,n,o){if(o%1!=0)throw"can't guess dimensions";if(r||n){if(n){if(!r&&(r=o/n)%1)throw"can't guess dimensions"}else if((n=o/r)%1)throw"can't guess dimensions"}else{const i=Math.sqrt(o/(t===e.TEXTURE_CUBE_MAP?6:1));i%1==0?(r=i,n=i):(r=o,n=1)}return{width:r,height:n}}const $={};function q(e,t){void 0!==t.colorspaceConversion&&($.colorspaceConversion=e.getParameter(e.UNPACK_COLORSPACE_CONVERSION_WEBGL),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.colorspaceConversion)),void 0!==t.premultiplyAlpha&&($.premultiplyAlpha=e.getParameter(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha)),void 0!==t.flipY&&($.flipY=e.getParameter(e.UNPACK_FLIP_Y_WEBGL),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY))}function Z(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,$.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,$.flipY)}function Q(e){$.unpackAlignment=e.getParameter(e.UNPACK_ALIGNMENT),D(e)&&($.unpackRowLength=e.getParameter(e.UNPACK_ROW_LENGTH),$.unpackImageHeight=e.getParameter(e.UNPACK_IMAGE_HEIGHT),$.unpackSkipPixels=e.getParameter(e.UNPACK_SKIP_PIXELS),$.unpackSkipRows=e.getParameter(e.UNPACK_SKIP_ROWS),$.unpackSkipImages=e.getParameter(e.UNPACK_SKIP_IMAGES))}function J(e){e.pixelStorei(e.UNPACK_ALIGNMENT,$.unpackAlignment),D(e)&&(e.pixelStorei(e.UNPACK_ROW_LENGTH,$.unpackRowLength),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,$.unpackImageHeight),e.pixelStorei(e.UNPACK_SKIP_PIXELS,$.unpackSkipPixels),e.pixelStorei(e.UNPACK_SKIP_ROWS,$.unpackSkipRows),e.pixelStorei(e.UNPACK_SKIP_IMAGES,$.unpackSkipImages))}function ee(e,t,r,n){var o;n.minMag&&(r.call(e,t,e.TEXTURE_MIN_FILTER,n.minMag),r.call(e,t,e.TEXTURE_MAG_FILTER,n.minMag)),n.min&&r.call(e,t,e.TEXTURE_MIN_FILTER,n.min),n.mag&&r.call(e,t,e.TEXTURE_MAG_FILTER,n.mag),n.wrap&&(r.call(e,t,e.TEXTURE_WRAP_S,n.wrap),r.call(e,t,e.TEXTURE_WRAP_T,n.wrap),(t===e.TEXTURE_3D||(o=t,"undefined"!=typeof WebGLSampler&&o instanceof WebGLSampler))&&r.call(e,t,e.TEXTURE_WRAP_R,n.wrap)),n.wrapR&&r.call(e,t,e.TEXTURE_WRAP_R,n.wrapR),n.wrapS&&r.call(e,t,e.TEXTURE_WRAP_S,n.wrapS),n.wrapT&&r.call(e,t,e.TEXTURE_WRAP_T,n.wrapT),n.minLod&&r.call(e,t,e.TEXTURE_MIN_LOD,n.minLod),n.maxLod&&r.call(e,t,e.TEXTURE_MAX_LOD,n.maxLod),n.baseLevel&&r.call(e,t,e.TEXTURE_BASE_LEVEL,n.baseLevel),n.maxLevel&&r.call(e,t,e.TEXTURE_MAX_LEVEL,n.maxLevel)}function te(e,t,r){const n=r.target||e.TEXTURE_2D;e.bindTexture(n,t),ee(e,n,e.texParameteri,r)}function re(e,t,r,n,o,i,a){r=r||z.textureOptions,i=i||e.RGBA,a=a||e.UNSIGNED_BYTE;const u=r.target||e.TEXTURE_2D;if(n=n||r.width,o=o||r.height,e.bindTexture(u,t),function(e,t,r,n){if(!D(e))return V(t)&&V(r);const o=Y[n];if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}(e,n,o,i))e.generateMipmap(u);else{const t=function(e){const t=Y[e];if(!t)throw"unknown internal format";return t.textureFilterable}(i)?e.LINEAR:e.NEAREST;e.texParameteri(u,e.TEXTURE_MIN_FILTER,t),e.texParameteri(u,e.TEXTURE_MAG_FILTER,t),e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}}function ne(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function oe(e,t){return(t=t||{}).cubeFaceOrder||[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z]}function ie(e,t){const r=oe(e,t).map(function(e,t){return{face:e,ndx:t}});return r.sort(function(e,t){return e.face-t.face}),r}function ae(e,t,r,n){const o=(n=n||z.textureOptions).target||e.TEXTURE_2D,i=n.level||0;let a=r.width,u=r.height;const l=n.internalFormat||n.format||e.RGBA,s=H(l),c=n.format||s.format,f=n.type||s.type;if(q(e,n),e.bindTexture(o,t),o===e.TEXTURE_CUBE_MAP){const s=r.width,m=r.height;let E,d;if(s/6===m)E=m,d=[0,0,1,0,2,0,3,0,4,0,5,0];else if(m/6===s)E=s,d=[0,0,0,1,0,2,0,3,0,4,0,5];else if(s/3==m/2)E=s/3,d=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(s/2!=m/3)throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);E=s/2,d=[0,0,1,0,0,1,1,1,0,2,1,2]}k?(k.canvas.width=E,k.canvas.height=E,a=E,u=E,ie(e,n).forEach(function(t){const n=d[2*t.ndx+0]*E,o=d[2*t.ndx+1]*E;k.drawImage(r,n,o,E,E,0,0,E,E),e.texImage2D(t.face,i,l,c,f,k.canvas)}),k.canvas.width=1,k.canvas.height=1):"undefined"!=typeof createImageBitmap&&(a=E,u=E,ie(e,n).forEach(function(s){const m=d[2*s.ndx+0]*E,y=d[2*s.ndx+1]*E;e.texImage2D(s.face,i,l,E,E,0,c,f,null),createImageBitmap(r,m,y,E,E,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(r){q(e,n),e.bindTexture(o,t),e.texImage2D(s.face,i,l,c,f,r),Z(e,n),ne(n)&&re(e,t,n,a,u,l,f)})}))}else if(o===e.TEXTURE_3D||o===e.TEXTURE_2D_ARRAY){const t=Math.min(r.width,r.height),n=Math.max(r.width,r.height),a=n/t;if(a%1!=0)throw"can not compute 3D dimensions of element";const u=r.width===n?1:0,s=r.height===n?1:0;Q(e),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_ROW_LENGTH,r.width),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.texImage3D(o,i,l,t,t,t,0,c,f,null);for(let n=0;n<a;++n){const a=n*t*u,l=n*t*s;e.pixelStorei(e.UNPACK_SKIP_PIXELS,a),e.pixelStorei(e.UNPACK_SKIP_ROWS,l),e.texSubImage3D(o,i,0,0,n,t,t,1,c,f,r)}J(e)}else e.texImage2D(o,i,l,c,f,r);Z(e,n),ne(n)&&re(e,t,n,a,u,l,f),te(e,t,n)}function ue(){}function le(e,t){return void 0!==t||function(e){if("undefined"!=typeof document){const t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}{const t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}(e)?t:"anonymous"}function se(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function ce(e,t,r){return se(e)?(setTimeout(function(){r(null,e)}),e):function(e,t,r){let n;if(r=r||ue,t=void 0!==t?t:z.crossOrigin,t=le(e,t),"undefined"!=typeof Image){n=new Image,void 0!==t&&(n.crossOrigin=t);const o=function(){n.removeEventListener("error",i),n.removeEventListener("load",a),n=null},i=function(){const t="couldn't load image: "+e;F(t),r(t,n),o()},a=function(){r(null,n),o()};return n.addEventListener("error",i),n.addEventListener("load",a),n.src=e,n}if("undefined"!=typeof ImageBitmap){let o,i;const a=function(){r(o,i)},u={};t&&(u.mode="cors"),fetch(e,u).then(function(e){if(!e.ok)throw e;return e.blob()}).then(function(e){return createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(e){i=e,setTimeout(a)}).catch(function(e){o=e,setTimeout(a)}),n=null}return n}(e,t,r)}function fe(e,t,r){const n=(r=r||z.textureOptions).target||e.TEXTURE_2D;if(e.bindTexture(n,t),!1===r.color)return;const o=function(e){return e=e||z.textureColor,X(e)?e:new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}(r.color);if(n===e.TEXTURE_CUBE_MAP)for(let t=0;t<6;++t)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);else n===e.TEXTURE_3D||n===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage2D(n,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o)}function me(e,t,r,n){n=n||ue;const o=r.src;if(6!==o.length)throw"there must be 6 urls for a cubemap";const i=r.level||0,a=r.internalFormat||r.format||e.RGBA,u=H(a),l=r.format||u.format,s=r.type||e.UNSIGNED_BYTE,c=r.target||e.TEXTURE_2D;if(c!==e.TEXTURE_CUBE_MAP)throw"target must be TEXTURE_CUBE_MAP";fe(e,t,r),r=Object.assign({},r);let f=6;const m=[],E=oe(e,r);let d;d=o.map(function(o,u){return ce(o,r.crossOrigin,(y=E[u],function(o,u){--f,o?m.push(o):u.width!==u.height?m.push("cubemap face img is not a square: "+u.src):(q(e,r),e.bindTexture(c,t),5===f?oe(e).forEach(function(t){e.texImage2D(t,i,a,l,s,u)}):e.texImage2D(y,i,a,l,s,u),Z(e,r),ne(r)&&e.generateMipmap(c)),0===f&&n(m.length?m:void 0,t,d)}));var y})}function Ee(e,t,r,n){n=n||ue;const o=r.src,i=r.internalFormat||r.format||e.RGBA,a=H(i),u=r.format||a.format,l=r.type||e.UNSIGNED_BYTE,s=r.target||e.TEXTURE_2D_ARRAY;if(s!==e.TEXTURE_3D&&s!==e.TEXTURE_2D_ARRAY)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";fe(e,t,r),r=Object.assign({},r);let c=o.length;const f=[];let m;const E=r.level||0;let d=r.width,y=r.height;const b=o.length;let p=!0;m=o.map(function(o,a){return ce(o,r.crossOrigin,(_=a,function(o,a){if(--c,o)f.push(o);else{if(q(e,r),e.bindTexture(s,t),p){p=!1,d=r.width||a.width,y=r.height||a.height,e.texImage3D(s,E,i,d,y,b,0,u,l,null);for(let t=0;t<b;++t)e.texSubImage3D(s,E,0,0,t,d,y,1,u,l,a)}else{let t=a;a.width===d&&a.height===y||(t=k.canvas,k.canvas.width=d,k.canvas.height=y,k.drawImage(a,0,0,d,y)),e.texSubImage3D(s,E,0,0,_,d,y,1,u,l,t),t===k.canvas&&(k.canvas.width=0,k.canvas.height=0)}Z(e,r),ne(r)&&e.generateMipmap(s)}0===c&&n(f.length?f:void 0,t,m)}));var _})}function de(e,t,r,n){const o=(n=n||z.textureOptions).target||e.TEXTURE_2D;e.bindTexture(o,t);let i=n.width,a=n.height,u=n.depth;const l=n.level||0,s=n.internalFormat||n.format||e.RGBA,c=H(s),f=n.format||c.format,m=n.type||function(e,t,r){return X(t)?x(t):r||e.UNSIGNED_BYTE}(e,r,c.type);if(X(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{const e=function(e){const t=R[e];if(!t)throw new Error("unknown gl type");return t}(m);r=new e(r)}const E=function(e,t){const r=Y[e];if(!r)throw"unknown internal format";const n=r.bytesPerElementMap[t];if(void 0===n)throw"unknown internal format";return n}(s,m),d=r.byteLength/E;if(d%1)throw"length wrong size for format: "+G(e,f);let y;if(o===e.TEXTURE_3D)if(i||a||u)!i||a&&u?!a||i&&u?(y=j(e,o,i,a,d/u),i=y.width,a=y.height):(y=j(e,o,i,u,d/a),i=y.width,u=y.height):(y=j(e,o,a,u,d/i),a=y.width,u=y.height);else{const e=Math.cbrt(d);if(e%1!=0)throw"can't guess cube size of array of numElements: "+d;i=e,a=e,u=e}else y=j(e,o,i,a,d),i=y.width,a=y.height;if(Q(e),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment||1),q(e,n),o===e.TEXTURE_CUBE_MAP){const t=d/6*(E/r.BYTES_PER_ELEMENT);ie(e,n).forEach(n=>{const o=t*n.ndx,u=r.subarray(o,o+t);e.texImage2D(n.face,l,s,i,a,0,f,m,u)})}else o===e.TEXTURE_3D?e.texImage3D(o,l,s,i,a,u,0,f,m,r):e.texImage2D(o,l,s,i,a,0,f,m,r);return Z(e,n),J(e),{width:i,height:a,depth:u,type:m}}function ye(e,t,r){r=r||ue,t=t||z.textureOptions;const n=e.createTexture(),o=t.target||e.TEXTURE_2D;let i=t.width||1,a=t.height||1;const u=t.internalFormat||e.RGBA,l=H(u);let s=t.type||l.type;e.bindTexture(o,n),o===e.TEXTURE_CUBE_MAP&&(e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE));let c=t.src;if(c)if("function"==typeof c&&(c=c(e,t)),"string"==typeof c)!function(e,t,r,n){n=n||ue,r=r||z.textureOptions,fe(e,t,r),ce((r=Object.assign({},r)).src,r.crossOrigin,function(o,i){o?n(o,t,i):(ae(e,t,i,r),n(null,t,i))})}(e,n,t,r);else if(X(c)||Array.isArray(c)&&("number"==typeof c[0]||Array.isArray(c[0])||X(c[0]))){const r=de(e,n,c,t);i=r.width,a=r.height,s=r.type}else if(Array.isArray(c)&&("string"==typeof c[0]||se(c[0])))o===e.TEXTURE_CUBE_MAP?me(e,n,t,r):Ee(e,n,t,r);else{if(!se(c))throw"unsupported src type";ae(e,n,c,t),i=c.width,a=c.height}else!function(e,t,r){const n=r.target||e.TEXTURE_2D;e.bindTexture(n,t);const o=r.level||0,i=r.internalFormat||r.format||e.RGBA,a=H(i),u=r.format||a.format,l=r.type||a.type;if(q(e,r),n===e.TEXTURE_CUBE_MAP)for(let t=0;t<6;++t)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,o,i,r.width,r.height,0,u,l,null);else n===e.TEXTURE_3D?e.texImage3D(n,o,i,r.width,r.height,r.depth,0,u,l,null):e.texImage2D(n,o,i,r.width,r.height,0,u,l,null);Z(e,r)}(e,n,t);return ne(t)&&re(e,n,t,i,a,u,s),te(e,n,t),n}const be=F,pe="undefined"!=typeof document&&document.getElementById?document.getElementById.bind(document):function(){return null},_e={};function he(e,t){return _e[t].bindPoint}function Ae(e,t){return function(r){e.uniform1i(t,r)}}function Te(e,t){return function(r){e.uniform1iv(t,r)}}function Re(e,t){return function(r){e.uniform2iv(t,r)}}function xe(e,t){return function(r){e.uniform3iv(t,r)}}function ge(e,t){return function(r){e.uniform4iv(t,r)}}function Fe(e,t,r,n){const o=he(0,t);return D(e)?function(t){let i,a;v(0,t)?(i=t,a=null):(i=t.texture,a=t.sampler),e.uniform1i(n,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(o,i),e.bindSampler(r,a)}:function(t){e.uniform1i(n,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(o,t)}}function Pe(e,t,r,n,o){const i=he(0,t),a=new Int32Array(o);for(let e=0;e<o;++e)a[e]=r+e;return D(e)?function(t){e.uniform1iv(n,a),t.forEach(function(t,n){let o,u;e.activeTexture(e.TEXTURE0+a[n]),v(0,t)?(o=t,u=null):(o=t.texture,u=t.sampler),e.bindSampler(r,u),e.bindTexture(i,o)})}:function(t){e.uniform1iv(n,a),t.forEach(function(t,r){e.activeTexture(e.TEXTURE0+a[r]),e.bindTexture(i,t)})}}function ve(e,t){return function(r){if(r.value)switch(e.disableVertexAttribArray(t),r.value.length){case 4:e.vertexAttrib4fv(t,r.value);break;case 3:e.vertexAttrib3fv(t,r.value);break;case 2:e.vertexAttrib2fv(t,r.value);break;case 1:e.vertexAttrib1fv(t,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.numComponents||r.size,r.type||e.FLOAT,r.normalize||!1,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function Ue(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an integer constant value must be 4!");e.vertexAttrib4iv(t,r.value)}else e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||e.INT,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function we(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");e.vertexAttrib4uiv(t,r.value)}else e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||e.UNSIGNED_INT,r.stride||0,r.offset||0),void 0!==r.divisor&&e.vertexAttribDivisor(t,r.divisor)}}function Ie(e,t,r){const n=r.size,o=r.count;return function(r){e.bindBuffer(e.ARRAY_BUFFER,r.buffer);const i=r.size||r.numComponents||n,a=i/o,u=r.type||e.FLOAT,l=_e[u].size*i,s=r.normalize||!1,c=r.offset||0,f=l/o;for(let n=0;n<o;++n)e.enableVertexAttribArray(t+n),e.vertexAttribPointer(t+n,a,u,s,l,c+f*n),void 0!==r.divisor&&e.vertexAttribDivisor(t+n,r.divisor)}}_e[5126]={Type:Float32Array,size:4,setter:function(e,t){return function(r){e.uniform1f(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1fv(t,r)}}},_e[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(r){e.uniform2fv(t,r)}}},_e[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(r){e.uniform3fv(t,r)}}},_e[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniform4fv(t,r)}}},_e[5124]={Type:Int32Array,size:4,setter:Ae,arraySetter:Te},_e[35667]={Type:Int32Array,size:8,setter:Re},_e[35668]={Type:Int32Array,size:12,setter:xe},_e[35669]={Type:Int32Array,size:16,setter:ge},_e[5125]={Type:Uint32Array,size:4,setter:function(e,t){return function(r){e.uniform1ui(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1uiv(t,r)}}},_e[36294]={Type:Uint32Array,size:8,setter:function(e,t){return function(r){e.uniform2uiv(t,r)}}},_e[36295]={Type:Uint32Array,size:12,setter:function(e,t){return function(r){e.uniform3uiv(t,r)}}},_e[36296]={Type:Uint32Array,size:16,setter:function(e,t){return function(r){e.uniform4uiv(t,r)}}},_e[35670]={Type:Uint32Array,size:4,setter:Ae,arraySetter:Te},_e[35671]={Type:Uint32Array,size:8,setter:Re},_e[35672]={Type:Uint32Array,size:12,setter:xe},_e[35673]={Type:Uint32Array,size:16,setter:ge},_e[35674]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}}},_e[35675]={Type:Float32Array,size:36,setter:function(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}}},_e[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}}},_e[35685]={Type:Float32Array,size:24,setter:function(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}}},_e[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}}},_e[35687]={Type:Float32Array,size:24,setter:function(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}}},_e[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}}},_e[35689]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}}},_e[35690]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}}},_e[35678]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:3553},_e[35680]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:34067},_e[35679]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:32879},_e[35682]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:3553},_e[36289]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:35866},_e[36292]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:35866},_e[36293]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:34067},_e[36298]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:3553},_e[36299]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:32879},_e[36300]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:34067},_e[36303]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:35866},_e[36306]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:3553},_e[36307]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:32879},_e[36308]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:34067},_e[36311]={Type:null,size:0,setter:Fe,arraySetter:Pe,bindPoint:35866};const Se={};Se[5126]={size:4,setter:ve},Se[35664]={size:8,setter:ve},Se[35665]={size:12,setter:ve},Se[35666]={size:16,setter:ve},Se[5124]={size:4,setter:Ue},Se[35667]={size:8,setter:Ue},Se[35668]={size:12,setter:Ue},Se[35669]={size:16,setter:Ue},Se[5125]={size:4,setter:we},Se[36294]={size:8,setter:we},Se[36295]={size:12,setter:we},Se[36296]={size:16,setter:we},Se[35670]={size:4,setter:Ue},Se[35671]={size:8,setter:Ue},Se[35672]={size:12,setter:Ue},Se[35673]={size:16,setter:Ue},Se[35674]={size:4,setter:Ie,count:2},Se[35675]={size:9,setter:Ie,count:3},Se[35676]={size:16,setter:Ie,count:4};const Be=/^[ \t]*\n/;function Le(e,t,r,n){const o=n||be,i=e.createShader(r);let a=0;if(Be.test(t)&&(a=1,t=t.replace(Be,"")),e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){const r=e.getShaderInfoLog(i);return o(function(e,t){return t=t||0,++t,e.split("\n").map(function(e,r){return r+t+": "+e}).join("\n")}(t,a)+"\n*** Error compiling shader: "+r),e.deleteShader(i),null}return i}function Me(e,t,r){let n;if("function"==typeof t&&(r=t,t=void 0),"function"==typeof e)r=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;const t=e;r=t.errorCallback,e=t.attribLocations,n=t.transformFeedbackVaryings}const o={errorCallback:r||be,transformFeedbackVaryings:n};if(e){let r={};Array.isArray(e)?e.forEach(function(e,n){r[e]=t?t[n]:n}):r=e,o.attribLocations=r}return o}const Ne=["VERTEX_SHADER","FRAGMENT_SHADER"];function Ce(e,t){return t.indexOf("frag")>=0?e.FRAGMENT_SHADER:t.indexOf("vert")>=0?e.VERTEX_SHADER:void 0}function Oe(e,t){t.forEach(function(t){e.deleteShader(t)})}function De(e,t,r,n,o){const i=Me(r,n,o),a=[];for(let r=0;r<t.length;++r){const n=Le(e,t[r],e[Ne[r]],i.errorCallback);if(!n)return null;a.push(n)}return function(e,t,r,n,o){const i=Me(r,n,o),a=[],u=[];for(let r=0;r<t.length;++r){let n=t[r];if("string"==typeof n){const t=pe(n),o=t?t.text:n;let a=e[Ne[r]];t&&t.type&&(a=Ce(e,t.type)||a),n=Le(e,o,a,i.errorCallback),u.push(n)}l=n,"undefined"!=typeof WebGLShader&&l instanceof WebGLShader&&a.push(n)}var l;if(a.length!==t.length)return i.errorCallback("not enough shaders for program"),Oe(e,u),null;const s=e.createProgram();a.forEach(function(t){e.attachShader(s,t)}),i.attribLocations&&Object.keys(i.attribLocations).forEach(function(t){e.bindAttribLocation(s,i.attribLocations[t],t)});let c=i.transformFeedbackVaryings;if(c&&(c.attribs&&(c=c.attribs),Array.isArray(c)||(c=Object.keys(c)),e.transformFeedbackVaryings(s,c,i.transformFeedbackMode||e.SEPARATE_ATTRIBS)),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){const t=e.getProgramInfoLog(s);return i.errorCallback("Error in program linking:"+t),e.deleteProgram(s),Oe(e,u),null}return s}(e,a,i)}function Ge(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function ze(e,t){const r={program:t,uniformSetters:function(e,t){let r=0;function n(t,n){const o=e.getUniformLocation(t,n.name),i=n.size>1&&"[0]"===n.name.substr(-3),a=n.type,u=_e[a];if(!u)throw new Error(`unknown type: 0x${a.toString(16)}`);let l;if(u.bindPoint){const t=r;r+=n.size,l=i?u.arraySetter(e,a,t,o,n.size):u.setter(e,a,t,o,n.size)}else l=u.arraySetter&&i?u.arraySetter(e,o):u.setter(e,o);return l.location=o,l}const o={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const i=e.getActiveUniform(t,r);if(Ge(i))continue;let a=i.name;"[0]"===a.substr(-3)&&(a=a.substr(0,a.length-3));const u=n(t,i);o[a]=u}return o}(e,t),attribSetters:function(e,t){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let o=0;o<n;++o){const n=e.getActiveAttrib(t,o);if(Ge(n))continue;const i=e.getAttribLocation(t,n.name),a=Se[n.type],u=a.setter(e,i,a);u.location=i,r[n.name]=u}return r}(e,t)};return D(e)&&(r.uniformBlockSpec=function(e,t){const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=[],o=[];for(let i=0;i<r;++i){o.push(i),n.push({});const r=e.getActiveUniform(t,i);if(Ge(r))break;n[i].name=r.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(r){const i=r[0],a=r[1];e.getActiveUniforms(t,o,e[i]).forEach(function(e,t){n[t][a]=e})});const i={},a=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS);for(let r=0;r<a;++r){const n=e.getActiveUniformBlockName(t,r),o={index:r,usedByVertexShader:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_DATA_SIZE),uniformIndices:e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)};o.used=o.usedByVertexShader||o.usedByFragmentShader,i[n]=o}return{blockSpecs:i,uniformData:n}}(e,t),r.transformFeedbackInfo=function(e,t){const r={},n=e.getProgramParameter(t,e.TRANSFORM_FEEDBACK_VARYINGS);for(let o=0;o<n;++o){const n=e.getTransformFeedbackVarying(t,o);r[n.name]={index:o,type:n.type,size:n.size}}return r}(e,t)),r}const Xe=36064,ke=[{format:6408,type:5121,min:9729,wrap:33071},{format:34041}],We={};We[34041]=33306,We[6401]=36128,We[36168]=36128,We[6402]=36096,We[33189]=36096;const Ke={};function Ye(e,t,r,n){const o=e.FRAMEBUFFER,i=e.createFramebuffer();e.bindFramebuffer(o,i),r=r||e.drawingBufferWidth,n=n||e.drawingBufferHeight;let a=0;const u={framebuffer:i,attachments:[],width:r,height:n};return(t=t||ke).forEach(function(t){let i=t.attachment;const l=t.format;let s=function(e){return We[e]}(l);if(s||(s=Xe+a++),!i)if(function(e){return Ke[e]}(l))i=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,l,r,n);else{const o=Object.assign({},t);o.width=r,o.height=n,void 0===o.auto&&(o.auto=!1,o.min=o.min||o.minMag||e.LINEAR,o.mag=o.mag||o.minMag||e.LINEAR,o.wrapS=o.wrapS||o.wrap||e.CLAMP_TO_EDGE,o.wrapT=o.wrapT||o.wrap||e.CLAMP_TO_EDGE),i=ye(e,o)}if(c=i,"undefined"!=typeof WebGLRenderbuffer&&c instanceof WebGLRenderbuffer)e.framebufferRenderbuffer(o,s,e.RENDERBUFFER,i);else{if(!v(0,i))throw new Error("unknown attachment type");void 0!==t.layer?e.framebufferTextureLayer(o,s,i,t.level||0,t.layer):e.framebufferTexture2D(o,s,t.texTarget||e.TEXTURE_2D,i,t.level||0)}var c;u.attachments.push(i)}),u}Ke[32854]=!0,Ke[32855]=!0,Ke[36194]=!0,Ke[34041]=!0,Ke[33189]=!0,Ke[6401]=!0,Ke[36168]=!0;const He=/^(.*?)_/;function Ve(e,t){G(e,0);const r=e.getExtension(t);if(r){const n={},o=He.exec(t)[1],i="_"+o;for(const t in r){const a=r[t],u="function"==typeof a,l=u?o:i;let s=t;t.endsWith(l)&&(s=t.substring(0,t.length-l.length)),void 0!==e[s]?u||e[s]===a||P(s,e[s],a,t):u?e[s]=function(e){return function(){return e.apply(r,arguments)}}(a):(e[s]=a,n[s]=a)}n.constructor={name:r.constructor.name},G(n,0)}return r}const je=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];const $e=200,qe=200,Ze=a([.1,.2,1]),Qe=[50,50,30],Je=32;let et,tt,rt;const nt={position:[-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0]},ot=[0,0,1];function it(t,r,i,a){return e(this,void 0,void 0,function*(){if(et=document.getElementById("c"),!(tt=et.getContext("webgl2")))return void(document.children[0].innerHTML="This browser has no WebGL2 support or it is not turned on.");!function(e){for(let t=0;t<je.length;++t)Ve(e,je[t])}(tt);const e=["noise-f","city-v","city-f","sky-f","simple-geo-v","star-f","raymarch-f","lattice-v","geo-f","quad-v","light-f","screen-f"],t=yield Promise.all(e.map(e=>{let t=document.getElementById(`${e}.glsl`);return t?t.innerHTML:document.getElementById(`${e}.glsl`)||function(e,t="text"){return new Promise(r=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType=t,n.onload=(()=>r(n.response)),n.send()})}(`./shaders/${e}.glsl`)})),[r,l,s,c,y,b,p,_,h,A,T,R]=(t.reduce((t,r,n)=>(t[e[n]]=r,t),{}),t),x=[et.clientWidth*a,et.clientHeight*a],g=ut(tt,x,{internalFormat:tt.DEPTH24_STENCIL8}),F=ut(tt,x,{internalFormat:tt.RGBA,min:tt.NEAREST}),P=(ut(tt,x,{internalFormat:tt.RGBA16F}),ut(tt,x,{internalFormat:tt.RGBA32F}),ut(tt,x,{internalFormat:tt.RGBA16F,min:a>1?tt.LINEAR:tt.NEAREST}));rt||(rt=function(e){let t=qe*qe*qe,r=Math.ceil(Math.sqrt(t));const n={programs:e,source:O(tt,nt),uniforms:{u_resolution:qe,u_side:r},target:Ye(tt,[{internalFormat:tt.R32F}],r,r)};tt.drawBuffers([tt.COLOR_ATTACHMENT0]),at(tt,n),tt.flush();const o=new Float32Array(r*r);return tt.readBuffer(tt.COLOR_ATTACHMENT0),tt.readPixels(0,0,r,r,tt.RED,tt.FLOAT,o),ye(tt,{target:tt.TEXTURE_3D,width:qe,height:qe,depth:qe,wrap:tt.MIRRORED_REPEAT,minMag:tt.LINEAR,internalFormat:tt.R16F,src:o.slice(0,t)})}([A,r]));const v=Ye(tt,[{attachment:F},{format:tt.DEPTH_STENCIL,attachment:g}],x[0],x[1]);tt.drawBuffers([tt.COLOR_ATTACHMENT0]),tt.enable(tt.DEPTH_TEST);const U={programs:[A,c],source:O(tt,nt),target:v};[...new Array(6)].map((e,t)=>0),nt.position.map(e=>200*e);const w={programs:[l,s],source:O(tt,{numElements:Qe[0]*Qe[1]*Qe[2]*6*6*3}),target:v},I={programs:[A,T],uniforms:{u_normal:F,u_depth:g},source:O(tt,nt),target:Ye(tt,[{attachment:P}],x[0],x[1])};tt.drawBuffers([tt.COLOR_ATTACHMENT0]);const S={programs:[A,R],uniforms:{u_color:I.target.attachments[0],u_bufferSize:x},source:O(tt,nt)};!function(e,t){t=t||1,t=Math.max(0,t);const r=e.clientWidth*t|0,n=e.clientHeight*t|0;(e.width!==r||e.height!==n)&&(e.width=r,e.height=n)}(et),tt.viewport(0,0,et.clientWidth,et.clientHeight);let B,L=new Int32Array(100);return tt.enable(tt.CULL_FACE),B=((e,t,r)=>{const a=function(e,t,r,n,o){o=o||new u(16);const i=1/Math.tan(.5*e),a=1/(r-n);return o[0]=i/t,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(r+n)*a,o[11]=-1,o[12]=0,o[13]=0,o[14]=r*n*a*2,o[15]=0,o}(40*Math.PI/180,et.clientWidth/et.clientHeight,5,2e3),l=d(t,n(t,r),ot),s=m(E(a,m(d([0,0,0],r,ot)))),c=E(a,m(l)),y=m(c),b=function(e){return(e=e||new u(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}();for(let e=0;e<L.length;e++)L[e]=0;for(let e=0;e<i.length;e++){let t=Math.floor(e/16);i[e]&&(L[t]=L[t]+(1<<e%16))}let p=n(t,o(r,12*Je)).map((e,t)=>Math.floor(e/Je-Qe[t]/2));const _={"u_light[0].pos":[1300,1e3,2e3],"u_light[0].color":[1,1,1,5],u_ambient:[1,1,1,.1],u_specular:[1,1,1,1],u_shininess:10,u_time:e,u_orbRadius:1+.2*Math.sin(3*e),u_eye:t,u_origin:p,u_toSun:Ze,u_resolution:$e,u_scale:100,u_depthRange:[5,2e3],u_bufferSize:x,u_viewInverse:l,u_near:5,u_far:2e3,u_a:2005/1995,u_b:2e4/1995,u_world:b,u_citySize:Qe,u_blockSize:Je,u_worldInverseTranspose:f(m(b)),u_worldViewProjection:c,u_inverseWorldViewProjection:y,u_raycastProjection:s,u_collected:L,u_noise:rt};Object.assign(I.uniforms,_),w.uniforms=_,U.uniforms=_,at(tt,w),at(tt,I),at(tt,S)})})}function at(e,t){!function(e,t,r){r=r||e.FRAMEBUFFER,t?(e.bindFramebuffer(r,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(r,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}(e,t.target),t.overwrite||e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),t.programInfo||(t.programInfo=function(e,t,r,n,o){const i=Me(r,n,o);let a=!0;if(t=t.map(function(e){if(e.indexOf("\n")<0){const t=pe(e);t?e=t.text:(i.errorCallback("no element with id: "+e),a=!1)}return e}),!a)return null;const u=De(e,t,i);return u?ze(e,u):null}(e,t.programs,e=>console.log(e)));const r=t.programInfo;e.useProgram(r.program),function(e,t,r){r.vertexArrayObject?e.bindVertexArray(r.vertexArrayObject):(function(e,t){for(const r in t){const n=e[r];n&&n(t[r])}}(t.attribSetters||t,r.attribs),r.indices&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indices))}(e,r,t.source),function e(t,r){const n=t.uniformSetters||t,o=arguments.length;for(let t=1;t<o;++t){const r=arguments[t];if(Array.isArray(r)){const t=r.length;for(let o=0;o<t;++o)e(n,r[o])}else for(const e in r){const t=n[e];t&&t(r[e])}}}(r,t.uniforms),function(e,t,r,n,o,i){r=void 0===r?e.TRIANGLES:r;const a=t.indices,u=t.elementType,l=void 0===n?t.numElements:n;o=void 0===o?0:o,u||a?void 0!==i?e.drawElementsInstanced(r,l,void 0===u?e.UNSIGNED_SHORT:t.elementType,o,i):e.drawElements(r,l,void 0===u?e.UNSIGNED_SHORT:t.elementType,o):void 0!==i?e.drawArraysInstanced(r,o,l,i):e.drawArrays(r,o,l)}(e,t.source),t.then&&t.then()}function ut(e,t,r){return ye(e,Object.assign({width:t[0],height:t[1]},r))}class lt{constructor(e){this.interval=100,this.pressed={},this.subs=[],e.addEventListener("keydown",this),e.addEventListener("keyup",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this)}handleEvent(e){let t,r;e instanceof KeyboardEvent?(t=e.code,r="keydown"==e.type?"down":"up"):(t="Click"+e.button,r="mousedown"==e.type?"down":"up"),"down"==r&&(t in this.pressed||(this.click(t),this.pressed[t]=window.setInterval(()=>this.click(t),this.interval))),"up"==r&&(window.clearInterval(this.pressed[t]),delete this.pressed[t])}click(e){for(let t of this.subs)t(e)}sub(e){this.subs.push(e)}unsub(e){this.subs=this.subs.filter(t=>t!=e)}once(e){let t=r=>{this.unsub(t),e(r)};this.sub(t)}isPressed(e){return e in this.pressed}clear(){this.subs=[]}}let st,ct,ft,mt,Et,dt=Math.PI/180,yt=0,bt=new Uint8Array(1e3),pt=0,_t=[];const ht=[0,0,0],At=30,Tt=300,Rt=.3,xt=.03,gt=10,Ft=100;function Pt(){return document.pointerLockElement==et&&!vt()}function vt(){return pt>=Ft}const Ut=3;window.onload=(t=>e(void 0,void 0,void 0,function*(){let e=yield it(0,0,bt,2),t=yield it(0,0,bt,1),r=e,i=document.getElementById("stats"),u=document.getElementById("orbs"),l=document.getElementById("pause"),s=document.getElementById("win");const c=new lt(document);document.addEventListener("keydown",n=>{"Space"==n.code&&(Pt()?document.exitPointerLock():et.requestPointerLock()),"KeyR"!=n.code?"KeyQ"!=n.code||(r=r==e?t:e):function(e=-1){e<0&&(e=Ut);let t=Math.max(1,_t.length-Ut),r=(_t=_t.slice(0,t))[_t.length-1];bt=new Uint8Array(1e3),pt=0;for(let e of _t)e.orb>=0&&pt++,bt[e.orb]=1;st=r.pos,yt=r.time,ct=r.vel,ft=r.rot,Et=ft.slice(),mt=[0,0]}(1e6)}),et.addEventListener("mousedown",e=>{Pt()?(0==e.button&&(pt--,ct+=30),2==e.button&&(ct=Math.max(ct-30,2*gt))):et.requestPointerLock()}),et.addEventListener("mousemove",e=>{mt[0]+=e.movementX,mt[1]+=e.movementY});let f=0;ct=At,st=ht,ft=[0,0],Et=[0,0],mt=[0,0];let m=[1,0,0];!function(e=-1){_t.push({pos:st,time:yt,orb:e,vel:ct,rot:ft})}();let E=0,d=60;window.requestAnimationFrame(function e(t){if(l.style.visibility=Pt()||vt()?"hidden":"visible",s.style.visibility=vt()?"visible":"hidden",vt())return void(s.innerHTML=`<h2>Congaturaleishuns!</h2> You have collected <b>${pt}</b> orbs in <b>${Math.floor(yt)} seconds!</b><br/><br/> Press <b>R</b> to restart.`);if(!Pt()&&E>0)return void window.requestAnimationFrame(e);let y=(t-f)/1e3;y>.1&&(y=.1),d=.99*d+.01/y,f=t,yt+=y,mt=mt.map(e=>Math.sign(e)*Math.min(30,Math.abs(e)*y*60)),ft[0]=ft[0]-.1*mt[0],ft[1]=Math.max(-89.999,Math.min(89.999,ft[1]-.1*mt[1]));let b=Math.min(1,30*y);Et=Et.map((e,t)=>e*(1-b)+ft[t]*b),mt=[0,0];let[p,_]=Et.map(e=>e*dt);if(m=a([Math.cos(_)*Math.cos(p),Math.cos(_)*Math.sin(p),Math.sin(_)]),mt=[0,0],c.pressed.KeyO&&(ct+=Tt*y),c.pressed.KeyL&&(ct=Math.max(0,ct-Tt*y)),(ct*=1-xt*y)<=gt){let e=gt-ct/100;st[2]-=e*Rt,ct+=e}let h=o(m,ct*y);ct-=h[2]*Rt,st=n(st,h),i.innerText=`Time: ${Math.floor(yt)} Position: ${st.map(e=>Math.round(e)).join(",")} Velocity: ${Math.floor(ct)} FPS: ${Math.round(d)}`,u.innerText=`Orbs: ${pt}/${Ft}`,r(yt,st,m),E++,window.requestAnimationFrame(e)})}))}();
